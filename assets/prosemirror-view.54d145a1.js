import{d as Cn}from"./prosemirror-state.34ed6358.js";import{d as Mn}from"./prosemirror-model.fc7226ba.js";import{b as Tn}from"./prosemirror-transform.d8dd870a.js";var ce={};function ke(e){return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ke(e)}function L(){return typeof Reflect!="undefined"&&Reflect.get?L=Reflect.get:L=function(r,t,n){var o=Pn(r,t);if(!!o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(arguments.length<3?r:n):i.value}},L.apply(this,arguments)}function Pn(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=E(e),e!==null););return e}function fe(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Ue(e,r)}function Ue(e,r){return Ue=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},Ue(e,r)}function de(e){var r=xn();return function(){var n=E(e),o;if(r){var i=E(this).constructor;o=Reflect.construct(n,arguments,i)}else o=n.apply(this,arguments);return Vn(this,o)}}function Vn(e,r){if(r&&(ke(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gt(e)}function Gt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},E(e)}function M(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function pt(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e,r,t){return r&&pt(e.prototype,r),t&&pt(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(ce,"__esModule",{value:!0});var y=Cn,O=Mn,En=Tn,ee=typeof navigator!="undefined"?navigator:null,mt=typeof document!="undefined"?document:null,ne=ee&&ee.userAgent||"",Ge=/Edge\/(\d+)/.exec(ne),Yt=/MSIE \d/.exec(ne),Ye=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ne),$=!!(Yt||Ye||Ge),_=Yt?document.documentMode:Ye?+Ye[1]:Ge?+Ge[1]:0,Y=!$&&/gecko\/(\d+)/i.test(ne);Y&&+(/Firefox\/(\d+)/.exec(ne)||[0,0])[1];var Je=!$&&/Chrome\/(\d+)/.exec(ne),A=!!Je,An=Je?+Je[1]:0,F=!$&&!!ee&&/Apple Computer/.test(ee.vendor),be=F&&(/Mobile\/\w+/.test(ne)||!!ee&&ee.maxTouchPoints>2),W=be||(ee?/Mac/.test(ee.platform):!1),U=/Android \d/.test(ne),Ie=!!mt&&"webkitFontSmoothing"in mt.documentElement.style,Rn=Ie?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,q=function(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t},nt=function(r){var t=r.assignedSlot||r.parentNode;return t&&t.nodeType==11?t.host:t},gt=null,Z=function(r,t,n){var o=gt||(gt=document.createRange());return o.setEnd(r,n==null?r.nodeValue.length:n),o.setStart(r,t||0),o},Te=function(r,t,n,o){return n&&(vt(r,t,n,o,-1)||vt(r,t,n,o,1))},Fn=/^(img|br|input|textarea|hr)$/i;function vt(e,r,t,n,o){for(;;){if(e==t&&r==n)return!0;if(r==(o<0?0:G(e))){var i=e.parentNode;if(!i||i.nodeType!=1||Bn(e)||Fn.test(e.nodeName)||e.contentEditable=="false")return!1;r=q(e)+(o<0?0:1),e=i}else if(e.nodeType==1){if(e=e.childNodes[r+(o<0?-1:0)],e.contentEditable=="false")return!1;r=o<0?G(e):0}else return!1}}function G(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function In(e,r,t){for(var n=r==0,o=r==G(e);n||o;){if(e==t)return!0;var i=q(e);if(e=e.parentNode,!e)return!1;n=n&&i==0,o=o&&i==G(e)}}function Bn(e){for(var r,t=e;t&&!(r=t.pmViewDesc);t=t.parentNode);return r&&r.node&&r.node.isBlock&&(r.dom==e||r.contentDOM==e)}var rt=function(r){var t=r.isCollapsed;return t&&A&&r.rangeCount&&!r.getRangeAt(0).collapsed&&(t=!1),t};function ge(e,r){var t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=e,t.key=t.code=r,t}function zn(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function j(e,r){return typeof e=="number"?e:e[r]}function Ln(e){var r=e.getBoundingClientRect(),t=r.width/e.offsetWidth||1,n=r.height/e.offsetHeight||1;return{left:r.left,right:r.left+e.clientWidth*t,top:r.top,bottom:r.top+e.clientHeight*n}}function yt(e,r,t){for(var n=e.someProp("scrollThreshold")||0,o=e.someProp("scrollMargin")||5,i=e.dom.ownerDocument,s=t||e.dom;s;s=nt(s))if(s.nodeType==1){var a=s,l=a==i.body,u=l?zn(i):Ln(a),c=0,f=0;if(r.top<u.top+j(n,"top")?f=-(u.top-r.top+j(o,"top")):r.bottom>u.bottom-j(n,"bottom")&&(f=r.bottom-u.bottom+j(o,"bottom")),r.left<u.left+j(n,"left")?c=-(u.left-r.left+j(o,"left")):r.right>u.right-j(n,"right")&&(c=r.right-u.right+j(o,"right")),c||f)if(l)i.defaultView.scrollBy(c,f);else{var d=a.scrollLeft,h=a.scrollTop;f&&(a.scrollTop+=f),c&&(a.scrollLeft+=c);var p=a.scrollLeft-d,g=a.scrollTop-h;r={left:r.left-p,top:r.top-g,right:r.right-p,bottom:r.bottom-g}}if(l)break}}function qn(e){for(var r=e.dom.getBoundingClientRect(),t=Math.max(0,r.top),n,o,i=(r.left+r.right)/2,s=t+1;s<Math.min(innerHeight,r.bottom);s+=5){var a=e.root.elementFromPoint(i,s);if(!(!a||a==e.dom||!e.dom.contains(a))){var l=a.getBoundingClientRect();if(l.top>=t-20){n=a,o=l.top;break}}}return{refDOM:n,refTop:o,stack:Jt(e.dom)}}function Jt(e){for(var r=[],t=e.ownerDocument,n=e;n&&(r.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),e!=t);n=nt(n));return r}function $n(e){var r=e.refDOM,t=e.refTop,n=e.stack,o=r?r.getBoundingClientRect().top:0;Qt(n,o==0?0:o-t)}function Qt(e,r){for(var t=0;t<e.length;t++){var n=e[t],o=n.dom,i=n.top,s=n.left;o.scrollTop!=i+r&&(o.scrollTop=i+r),o.scrollLeft!=s&&(o.scrollLeft=s)}}var pe=null;function Kn(e){if(e.setActive)return e.setActive();if(pe)return e.focus(pe);var r=Jt(e);e.focus(pe==null?{get preventScroll(){return pe={preventScroll:!0},!0}}:void 0),pe||(pe=!1,Qt(r,0))}function Zt(e,r){for(var t,n=2e8,o,i=0,s=r.top,a=r.top,l=e.firstChild,u=0;l;l=l.nextSibling,u++){var c=void 0;if(l.nodeType==1)c=l.getClientRects();else if(l.nodeType==3)c=Z(l).getClientRects();else continue;for(var f=0;f<c.length;f++){var d=c[f];if(d.top<=s&&d.bottom>=a){s=Math.max(d.bottom,s),a=Math.min(d.top,a);var h=d.left>r.left?d.left-r.left:d.right<r.left?r.left-d.right:0;if(h<n){t=l,n=h,o=h&&t.nodeType==3?{left:d.right<r.left?d.right:d.left,top:r.top}:r,l.nodeType==1&&h&&(i=u+(r.left>=(d.left+d.right)/2?1:0));continue}}!t&&(r.left>=d.right&&r.top>=d.top||r.left>=d.left&&r.top>=d.bottom)&&(i=u+1)}}return t&&t.nodeType==3?Wn(t,o):!t||n&&t.nodeType==1?{node:e,offset:i}:Zt(t,o)}function Wn(e,r){for(var t=e.nodeValue.length,n=document.createRange(),o=0;o<t;o++){n.setEnd(e,o+1),n.setStart(e,o);var i=w(n,1);if(i.top!=i.bottom&&ot(r,i))return{node:e,offset:o+(r.left>=(i.left+i.right)/2?1:0)}}return{node:e,offset:0}}function ot(e,r){return e.left>=r.left-1&&e.left<=r.right+1&&e.top>=r.top-1&&e.top<=r.bottom+1}function Hn(e,r){var t=e.parentNode;return t&&/^li$/i.test(t.nodeName)&&r.left<e.getBoundingClientRect().left?t:e}function Un(e,r,t){var n=Zt(r,t),o=n.node,i=n.offset,s=-1;if(o.nodeType==1&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&t.left>(a.left+a.right)/2?1:-1}return e.docView.posFromDOM(o,i,s)}function Gn(e,r,t,n){for(var o=-1,i=r;i!=e.dom;){var s=e.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>n.left||a.top>n.top)o=s.posBefore;else if(a.right<n.left||a.bottom<n.top)o=s.posAfter;else break}i=s.dom.parentNode}return o>-1?o:e.docView.posFromDOM(r,t,1)}function Xt(e,r,t){var n=e.childNodes.length;if(n&&t.top<t.bottom)for(var o=Math.max(0,Math.min(n-1,Math.floor(n*(r.top-t.top)/(t.bottom-t.top))-2)),i=o;;){var s=e.childNodes[i];if(s.nodeType==1)for(var a=s.getClientRects(),l=0;l<a.length;l++){var u=a[l];if(ot(r,u))return Xt(s,r,u)}if((i=(i+1)%n)==o)break}return e}function Yn(e,r){var t=e.dom.ownerDocument,n,o=0;if(t.caretPositionFromPoint)try{var i=t.caretPositionFromPoint(r.left,r.top);i&&(n=i.offsetNode,o=i.offset)}catch{}if(!n&&t.caretRangeFromPoint){var s=t.caretRangeFromPoint(r.left,r.top);s&&(n=s.startContainer,o=s.startOffset)}var a=(e.root.elementFromPoint?e.root:t).elementFromPoint(r.left,r.top+1),l;if(!a||!e.dom.contains(a.nodeType!=1?a.parentNode:a)){var u=e.dom.getBoundingClientRect();if(!ot(r,u)||(a=Xt(e.dom,r,u),!a))return null}if(F)for(var c=a;n&&c;c=nt(c))c.draggable&&(n=void 0);if(a=Hn(a,r),n){if(Y&&n.nodeType==1&&(o=Math.min(o,n.childNodes.length),o<n.childNodes.length)){var f=n.childNodes[o],d;f.nodeName=="IMG"&&(d=f.getBoundingClientRect()).right<=r.left&&d.bottom>r.top&&o++}n==e.dom&&o==n.childNodes.length-1&&n.lastChild.nodeType==1&&r.top>n.lastChild.getBoundingClientRect().bottom?l=e.state.doc.content.size:(o==0||n.nodeType!=1||n.childNodes[o-1].nodeName!="BR")&&(l=Gn(e,n,o,r))}l==null&&(l=Un(e,a,r));var h=e.docView.nearestDesc(a,!0);return{pos:l,inside:h?h.posAtStart-h.border:-1}}function w(e,r){var t=e.getClientRects();return t.length?t[r<0?0:t.length-1]:e.getBoundingClientRect()}var Jn=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function jt(e,r,t){var n=e.docView.domFromPos(r,t<0?-1:1),o=n.node,i=n.offset,s=Ie||Y;if(o.nodeType==3)if(s&&(Jn.test(o.nodeValue)||(t<0?!i:i==o.nodeValue.length))){var a=w(Z(o,i,i),t);if(Y&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var l=w(Z(o,i-1,i-1),-1);if(l.top==a.top){var u=w(Z(o,i,i+1),-1);if(u.top!=a.top)return Ne(u,u.left<l.left)}}return a}else{var c=i,f=i,d=t<0?1:-1;return t<0&&!i?(f++,d=-1):t>=0&&i==o.nodeValue.length?(c--,d=1):t<0?c--:f++,Ne(w(Z(o,c,f),d),d<0)}if(!e.state.doc.resolve(r).parent.inlineContent){if(i&&(t<0||i==G(o))){var h=o.childNodes[i-1];if(h.nodeType==1)return Le(h.getBoundingClientRect(),!1)}if(i<G(o)){var p=o.childNodes[i];if(p.nodeType==1)return Le(p.getBoundingClientRect(),!0)}return Le(o.getBoundingClientRect(),t>=0)}if(i&&(t<0||i==G(o))){var g=o.childNodes[i-1],D=g.nodeType==3?Z(g,G(g)-(s?0:1)):g.nodeType==1&&(g.nodeName!="BR"||!g.nextSibling)?g:null;if(D)return Ne(w(D,1),!1)}if(i<G(o)){for(var v=o.childNodes[i];v.pmViewDesc&&v.pmViewDesc.ignoreForCoords;)v=v.nextSibling;var m=v?v.nodeType==3?Z(v,0,s?0:1):v.nodeType==1?v:null:null;if(m)return Ne(w(m,-1),!0)}return Ne(w(o.nodeType==3?Z(o):o,-t),t>=0)}function Ne(e,r){if(e.width==0)return e;var t=r?e.left:e.right;return{top:e.top,bottom:e.bottom,left:t,right:t}}function Le(e,r){if(e.height==0)return e;var t=r?e.top:e.bottom;return{top:t,bottom:t,left:e.left,right:e.right}}function wt(e,r,t){var n=e.state,o=e.root.activeElement;n!=r&&e.updateState(r),o!=e.dom&&e.focus();try{return t()}finally{n!=r&&e.updateState(n),o!=e.dom&&o&&o.focus()}}function Qn(e,r,t){var n=r.selection,o=t=="up"?n.$from:n.$to;return wt(e,r,function(){for(var i=e.docView.domFromPos(o.pos,t=="up"?-1:1),s=i.node;;){var a=e.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}for(var l=jt(e,o.pos,1),u=s.firstChild;u;u=u.nextSibling){var c=void 0;if(u.nodeType==1)c=u.getClientRects();else if(u.nodeType==3)c=Z(u,0,u.nodeValue.length).getClientRects();else continue;for(var f=0;f<c.length;f++){var d=c[f];if(d.bottom>d.top+1&&(t=="up"?l.top-d.top>(d.bottom-l.top)*2:d.bottom-l.bottom>(l.bottom-d.top)*2))return!1}}return!0})}var Zn=/[\u0590-\u08ac]/;function Xn(e,r,t){var n=r.selection.$head;if(!n.parent.isTextblock)return!1;var o=n.parentOffset,i=!o,s=o==n.parent.content.size,a=e.domSelection();return!Zn.test(n.parent.textContent)||!a.modify?t=="left"||t=="backward"?i:s:wt(e,r,function(){var l=a.getRangeAt(0),u=a.focusNode,c=a.focusOffset,f=a.caretBidiLevel;a.modify("move",t,"character");var d=n.depth?e.docView.domAfterPos(n.before()):e.dom,h=!d.contains(a.focusNode.nodeType==1?a.focusNode:a.focusNode.parentNode)||u==a.focusNode&&c==a.focusOffset;return a.removeAllRanges(),a.addRange(l),f!=null&&(a.caretBidiLevel=f),h})}var kt=null,bt=null,Dt=!1;function jn(e,r,t){return kt==r&&bt==t?Dt:(kt=r,bt=t,Dt=t=="up"||t=="down"?Qn(e,r,t):Xn(e,r,t))}var H=0,St=1,ve=2,J=3,Ee=function(){function e(r,t,n,o){M(this,e),this.parent=r,this.children=t,this.dom=n,this.contentDOM=o,this.dirty=H,n.pmViewDesc=this}return T(e,[{key:"matchesWidget",value:function(t){return!1}},{key:"matchesMark",value:function(t){return!1}},{key:"matchesNode",value:function(t,n,o){return!1}},{key:"matchesHack",value:function(t){return!1}},{key:"parseRule",value:function(){return null}},{key:"stopEvent",value:function(t){return!1}},{key:"size",get:function(){for(var t=0,n=0;n<this.children.length;n++)t+=this.children[n].size;return t}},{key:"border",get:function(){return 0}},{key:"destroy",value:function(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(var t=0;t<this.children.length;t++)this.children[t].destroy()}},{key:"posBeforeChild",value:function(t){for(var n=0,o=this.posAtStart;;n++){var i=this.children[n];if(i==t)return o;o+=i.size}}},{key:"posBefore",get:function(){return this.parent.posBeforeChild(this)}},{key:"posAtStart",get:function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}},{key:"posAfter",get:function(){return this.posBefore+this.size}},{key:"posAtEnd",get:function(){return this.posAtStart+this.size-2*this.border}},{key:"localPosFromDOM",value:function(t,n,o){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(o<0){var i,s;if(t==this.contentDOM)i=t.childNodes[n-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;i=t.previousSibling}for(;i&&!((s=i.pmViewDesc)&&s.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(s)+s.size:this.posAtStart}else{var a,l;if(t==this.contentDOM)a=t.childNodes[n];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;a=t.nextSibling}for(;a&&!((l=a.pmViewDesc)&&l.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(l):this.posAtEnd}var u;if(t==this.dom&&this.contentDOM)u=n>q(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))u=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(var c=t;;c=c.parentNode){if(c==this.dom){u=!1;break}if(c.previousSibling)break}if(u==null&&n==t.childNodes.length)for(var f=t;;f=f.parentNode){if(f==this.dom){u=!0;break}if(f.nextSibling)break}}return(u==null?o>0:u)?this.posAtEnd:this.posAtStart}},{key:"nearestDesc",value:function(t){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=!0,i=t;i;i=i.parentNode){var s=this.getDesc(i),a=void 0;if(s&&(!n||s.node))if(o&&(a=s.nodeDOM)&&!(a.nodeType==1?a.contains(t.nodeType==1?t:t.parentNode):a==t))o=!1;else return s}}},{key:"getDesc",value:function(t){for(var n=t.pmViewDesc,o=n;o;o=o.parent)if(o==this)return n}},{key:"posFromDOM",value:function(t,n,o){for(var i=t;i;i=i.parentNode){var s=this.getDesc(i);if(s)return s.localPosFromDOM(t,n,o)}return-1}},{key:"descAt",value:function(t){for(var n=0,o=0;n<this.children.length;n++){var i=this.children[n],s=o+i.size;if(o==t&&s!=o){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(t<s)return i.descAt(t-o-i.border);o=s}}},{key:"domFromPos",value:function(t,n){if(!this.contentDOM)return{node:this.dom,offset:0};for(var o=0,i=0,s=0;o<this.children.length;o++){var a=this.children[o],l=s+a.size;if(l>t||a instanceof tn){i=t-s;break}s=l}if(i)return this.children[o].domFromPos(i-this.children[o].border,n);for(var u;o&&!(u=this.children[o-1]).size&&u instanceof _t&&u.side>=0;o--);if(n<=0){for(var c,f=!0;c=o?this.children[o-1]:null,!(!c||c.dom.parentNode==this.contentDOM);o--,f=!1);return c&&n&&f&&!c.border&&!c.domAtom?c.domFromPos(c.size,n):{node:this.contentDOM,offset:c?q(c.dom)+1:0}}else{for(var d,h=!0;d=o<this.children.length?this.children[o]:null,!(!d||d.dom.parentNode==this.contentDOM);o++,h=!1);return d&&h&&!d.border&&!d.domAtom?d.domFromPos(0,n):{node:this.contentDOM,offset:d?q(d.dom):this.contentDOM.childNodes.length}}}},{key:"parseRange",value:function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(this.children.length==0)return{node:this.contentDOM,from:t,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var i=-1,s=-1,a=o,l=0;;l++){var u=this.children[l],c=a+u.size;if(i==-1&&t<=c){var f=a+u.border;if(t>=f&&n<=c-u.border&&u.node&&u.contentDOM&&this.contentDOM.contains(u.contentDOM))return u.parseRange(t,n,f);t=a;for(var d=l;d>0;d--){var h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){i=q(h.dom)+1;break}t-=h.size}i==-1&&(i=0)}if(i>-1&&(c>n||l==this.children.length-1)){n=c;for(var p=l+1;p<this.children.length;p++){var g=this.children[p];if(g.size&&g.dom.parentNode==this.contentDOM&&!g.emptyChildAt(-1)){s=q(g.dom);break}n+=g.size}s==-1&&(s=this.contentDOM.childNodes.length);break}a=c}return{node:this.contentDOM,from:t,to:n,fromOffset:i,toOffset:s}}},{key:"emptyChildAt",value:function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var n=this.children[t<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(t)}},{key:"domAfterPos",value:function(t){var n=this.domFromPos(t,0),o=n.node,i=n.offset;if(o.nodeType!=1||i==o.childNodes.length)throw new RangeError("No node after pos "+t);return o.childNodes[i]}},{key:"setSelection",value:function(t,n,o){for(var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=Math.min(t,n),a=Math.max(t,n),l=0,u=0;l<this.children.length;l++){var c=this.children[l],f=u+c.size;if(s>u&&a<f)return c.setSelection(t-u-c.border,n-u-c.border,o,i);u=f}var d=this.domFromPos(t,t?-1:1),h=n==t?d:this.domFromPos(n,n?-1:1),p=o.getSelection(),g=!1;if((Y||F)&&t==n){var D=d,v=D.node,m=D.offset;if(v.nodeType==3){if(g=!!(m&&v.nodeValue[m-1]==`
`),g&&m==v.nodeValue.length)for(var S=v,k;S;S=S.parentNode){if(k=S.nextSibling){k.nodeName=="BR"&&(d=h={node:k.parentNode,offset:q(k)+1});break}var b=S.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{var N=v.childNodes[m-1];g=N&&(N.nodeName=="BR"||N.contentEditable=="false")}}if(Y&&p.focusNode&&p.focusNode!=h.node&&p.focusNode.nodeType==1){var B=p.focusNode.childNodes[p.focusOffset];B&&B.contentEditable=="false"&&(i=!0)}if(!(!(i||g&&F)&&Te(d.node,d.offset,p.anchorNode,p.anchorOffset)&&Te(h.node,h.offset,p.focusNode,p.focusOffset))){var K=!1;if((p.extend||t==n)&&!g){p.collapse(d.node,d.offset);try{t!=n&&p.extend(h.node,h.offset),K=!0}catch(P){if(!(P instanceof DOMException))throw P}}if(!K){if(t>n){var x=d;d=h,h=x}var z=document.createRange();z.setEnd(h.node,h.offset),z.setStart(d.node,d.offset),p.removeAllRanges(),p.addRange(z)}}}},{key:"ignoreMutation",value:function(t){return!this.contentDOM&&t.type!="selection"}},{key:"contentLost",get:function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}},{key:"markDirty",value:function(t,n){for(var o=0,i=0;i<this.children.length;i++){var s=this.children[i],a=o+s.size;if(o==a?t<=a&&n>=o:t<a&&n>o){var l=o+s.border,u=a-s.border;if(t>=l&&n<=u){this.dirty=t==o||n==a?ve:St,t==l&&n==u&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=J:s.markDirty(t-l,n-l);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?ve:J}o=a}this.dirty=ve}},{key:"markParentsDirty",value:function(){for(var t=1,n=this.parent;n;n=n.parent,t++){var o=t==1?ve:St;n.dirty<o&&(n.dirty=o)}}},{key:"domAtom",get:function(){return!1}},{key:"ignoreForCoords",get:function(){return!1}}]),e}(),_t=function(e){fe(t,e);var r=de(t);function t(n,o,i,s){var a;M(this,t);var l,u=o.type.toDOM;if(typeof u=="function"&&(u=u(i,function(){if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)})),!o.type.spec.raw){if(u.nodeType!=1){var c=document.createElement("span");c.appendChild(u),u=c}u.contentEditable="false",u.classList.add("ProseMirror-widget")}return a=r.call(this,n,[],u,null),a.widget=o,a.widget=o,l=Gt(a),a}return T(t,[{key:"matchesWidget",value:function(o){return this.dirty==H&&o.type.eq(this.widget.type)}},{key:"parseRule",value:function(){return{ignore:!0}}},{key:"stopEvent",value:function(o){var i=this.widget.spec.stopEvent;return i?i(o):!1}},{key:"ignoreMutation",value:function(o){return o.type!="selection"||this.widget.spec.ignoreSelection}},{key:"destroy",value:function(){this.widget.type.destroy(this.dom),L(E(t.prototype),"destroy",this).call(this)}},{key:"domAtom",get:function(){return!0}},{key:"side",get:function(){return this.widget.type.side}}]),t}(Ee),wn=function(e){fe(t,e);var r=de(t);function t(n,o,i,s){var a;return M(this,t),a=r.call(this,n,[],o,null),a.textDOM=i,a.text=s,a}return T(t,[{key:"size",get:function(){return this.text.length}},{key:"localPosFromDOM",value:function(o,i){return o!=this.textDOM?this.posAtStart+(i?this.size:0):this.posAtStart+i}},{key:"domFromPos",value:function(o){return{node:this.textDOM,offset:o}}},{key:"ignoreMutation",value:function(o){return o.type==="characterData"&&o.target.nodeValue==o.oldValue}}]),t}(Ee),Ae=function(e){fe(t,e);var r=de(t);function t(n,o,i,s){var a;return M(this,t),a=r.call(this,n,[],i,s),a.mark=o,a}return T(t,[{key:"parseRule",value:function(){return this.dirty&J||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}},{key:"matchesMark",value:function(o){return this.dirty!=J&&this.mark.eq(o)}},{key:"markDirty",value:function(o,i){if(L(E(t.prototype),"markDirty",this).call(this,o,i),this.dirty!=H){for(var s=this.parent;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=H}}},{key:"slice",value:function(o,i,s){var a=t.create(this.parent,this.mark,!0,s),l=this.children,u=this.size;i<u&&(l=Xe(l,i,u,s)),o>0&&(l=Xe(l,0,o,s));for(var c=0;c<l.length;c++)l[c].parent=a;return a.children=l,a}}],[{key:"create",value:function(o,i,s,a){var l=a.nodeViews[i.type.name],u=l&&l(i,a,s);return(!u||!u.dom)&&(u=O.DOMSerializer.renderSpec(document,i.type.spec.toDOM(i,s))),new t(o,i,u.dom,u.contentDOM||u.dom)}}]),t}(Ee),Pe=function(e){fe(t,e);var r=de(t);function t(n,o,i,s,a,l,u,c,f){var d;return M(this,t),d=r.call(this,n,[],a,l),d.node=o,d.outerDeco=i,d.innerDeco=s,d.nodeDOM=u,l&&d.updateChildren(c,f),d}return T(t,[{key:"parseRule",value:function(){var o=this;if(this.node.type.spec.reparseInView)return null;var i={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(i.preserveWhitespace="full"),!this.contentDOM)i.getContent=function(){return o.node.content};else if(!this.contentLost)i.contentElement=this.contentDOM;else{for(var s=this.children.length-1;s>=0;s--){var a=this.children[s];if(this.dom.contains(a.dom.parentNode)){i.contentElement=a.dom.parentNode;break}}i.contentElement||(i.getContent=function(){return O.Fragment.empty})}return i}},{key:"matchesNode",value:function(o,i,s){return this.dirty==H&&o.eq(this.node)&&Ze(i,this.outerDeco)&&s.eq(this.innerDeco)}},{key:"size",get:function(){return this.node.nodeSize}},{key:"border",get:function(){return this.node.isLeaf?0:1}},{key:"updateChildren",value:function(o,i){var s=this,a=this.node.inlineContent,l=i,u=o.composing?this.localCompositionInfo(o,i):null,c=u&&u.pos>-1?u:null,f=u&&u.pos<0,d=new tr(this,c&&c.node);or(this.node,this.innerDeco,function(h,p,g){h.spec.marks?d.syncToMarks(h.spec.marks,a,o):h.type.side>=0&&!g&&d.syncToMarks(p==s.node.childCount?O.Mark.none:s.node.child(p).marks,a,o),d.placeWidget(h,o,l)},function(h,p,g,D){d.syncToMarks(h.marks,a,o);var v;d.findNodeMatch(h,p,g,D)||f&&o.state.selection.from>l&&o.state.selection.to<l+h.nodeSize&&(v=d.findIndexWithChild(u.node))>-1&&d.updateNodeAt(h,p,g,v,o)||d.updateNextNode(h,p,g,o,D)||d.addNode(h,p,g,o,l),l+=h.nodeSize}),d.syncToMarks([],a,o),this.node.isTextblock&&d.addTextblockHacks(),d.destroyRest(),(d.changed||this.dirty==ve)&&(c&&this.protectLocalComposition(o,c),nn(this.contentDOM,this.children,o),be&&ir(this.dom))}},{key:"localCompositionInfo",value:function(o,i){var s=o.state.selection,a=s.from,l=s.to;if(!(o.state.selection instanceof y.TextSelection)||a<i||l>i+this.node.content.size)return null;var u=o.domSelection(),c=sr(u.focusNode,u.focusOffset);if(!c||!this.dom.contains(c.parentNode))return null;if(this.node.inlineContent){var f=c.nodeValue,d=ar(this.node.content,f,a-i,l-i);return d<0?null:{node:c,pos:d,text:f}}else return{node:c,pos:-1,text:""}}},{key:"protectLocalComposition",value:function(o,i){var s=i.node,a=i.pos,l=i.text;if(!this.getDesc(s)){for(var u=s;u.parentNode!=this.contentDOM;u=u.parentNode){for(;u.previousSibling;)u.parentNode.removeChild(u.previousSibling);for(;u.nextSibling;)u.parentNode.removeChild(u.nextSibling);u.pmViewDesc&&(u.pmViewDesc=void 0)}var c=new wn(this,u,s,l);o.input.compositionNodes.push(c),this.children=Xe(this.children,a,a+l.length,o,c)}}},{key:"update",value:function(o,i,s,a){return this.dirty==J||!o.sameMarkup(this.node)?!1:(this.updateInner(o,i,s,a),!0)}},{key:"updateInner",value:function(o,i,s,a){this.updateOuterDeco(i),this.node=o,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=H}},{key:"updateOuterDeco",value:function(o){if(!Ze(o,this.outerDeco)){var i=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=rn(this.dom,this.nodeDOM,Qe(this.outerDeco,this.node,i),Qe(o,this.node,i)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=o}}},{key:"selectNode",value:function(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}},{key:"deselectNode",value:function(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}},{key:"domAtom",get:function(){return this.node.isAtom}}],[{key:"create",value:function(o,i,s,a,l,u){var c=l.nodeViews[i.type.name],f,d=c&&c(i,l,function(){if(!f)return u;if(f.parent)return f.parent.posBeforeChild(f)},s,a),h=d&&d.dom,p=d&&d.contentDOM;if(i.isText){if(!h)h=document.createTextNode(i.text);else if(h.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else if(!h){var g=O.DOMSerializer.renderSpec(document,i.type.spec.toDOM(i));h=g.dom,p=g.contentDOM}!p&&!i.isText&&h.nodeName!="BR"&&(h.hasAttribute("contenteditable")||(h.contentEditable="false"),i.type.spec.draggable&&(h.draggable=!0));var D=h;return h=on(h,s,i),d?f=new _n(o,i,s,a,h,p||null,D,d,l,u+1):i.isText?new en(o,i,s,a,h,D,l):new t(o,i,s,a,h,p||null,D,l,u+1)}}]),t}(Ee);function Nt(e,r,t,n,o){return on(n,r,e),new Pe(void 0,e,r,t,n,n,n,o,0)}var en=function(e){fe(t,e);var r=de(t);function t(n,o,i,s,a,l,u){return M(this,t),r.call(this,n,o,i,s,a,null,l,u,0)}return T(t,[{key:"parseRule",value:function(){for(var o=this.nodeDOM.parentNode;o&&o!=this.dom&&!o.pmIsDeco;)o=o.parentNode;return{skip:o||!0}}},{key:"update",value:function(o,i,s,a){return this.dirty==J||this.dirty!=H&&!this.inParent()||!o.sameMarkup(this.node)?!1:(this.updateOuterDeco(i),(this.dirty!=H||o.text!=this.node.text)&&o.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=o.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=o,this.dirty=H,!0)}},{key:"inParent",value:function(){for(var o=this.parent.contentDOM,i=this.nodeDOM;i;i=i.parentNode)if(i==o)return!0;return!1}},{key:"domFromPos",value:function(o){return{node:this.nodeDOM,offset:o}}},{key:"localPosFromDOM",value:function(o,i,s){return o==this.nodeDOM?this.posAtStart+Math.min(i,this.node.text.length):L(E(t.prototype),"localPosFromDOM",this).call(this,o,i,s)}},{key:"ignoreMutation",value:function(o){return o.type!="characterData"&&o.type!="selection"}},{key:"slice",value:function(o,i,s){var a=this.node.cut(o,i),l=document.createTextNode(a.text);return new t(this.parent,a,this.outerDeco,this.innerDeco,l,l,s)}},{key:"markDirty",value:function(o,i){L(E(t.prototype),"markDirty",this).call(this,o,i),this.dom!=this.nodeDOM&&(o==0||i==this.nodeDOM.nodeValue.length)&&(this.dirty=J)}},{key:"domAtom",get:function(){return!1}}]),t}(Pe),tn=function(e){fe(t,e);var r=de(t);function t(){return M(this,t),r.apply(this,arguments)}return T(t,[{key:"parseRule",value:function(){return{ignore:!0}}},{key:"matchesHack",value:function(o){return this.dirty==H&&this.dom.nodeName==o}},{key:"domAtom",get:function(){return!0}},{key:"ignoreForCoords",get:function(){return this.dom.nodeName=="IMG"}}]),t}(Ee),_n=function(e){fe(t,e);var r=de(t);function t(n,o,i,s,a,l,u,c,f,d){var h;return M(this,t),h=r.call(this,n,o,i,s,a,l,u,f,d),h.spec=c,h}return T(t,[{key:"update",value:function(o,i,s,a){if(this.dirty==J)return!1;if(this.spec.update){var l=this.spec.update(o,i,s);return l&&this.updateInner(o,i,s,a),l}else return!this.contentDOM&&!o.isLeaf?!1:L(E(t.prototype),"update",this).call(this,o,i,s,a)}},{key:"selectNode",value:function(){this.spec.selectNode?this.spec.selectNode():L(E(t.prototype),"selectNode",this).call(this)}},{key:"deselectNode",value:function(){this.spec.deselectNode?this.spec.deselectNode():L(E(t.prototype),"deselectNode",this).call(this)}},{key:"setSelection",value:function(o,i,s,a){this.spec.setSelection?this.spec.setSelection(o,i,s):L(E(t.prototype),"setSelection",this).call(this,o,i,s,a)}},{key:"destroy",value:function(){this.spec.destroy&&this.spec.destroy(),L(E(t.prototype),"destroy",this).call(this)}},{key:"stopEvent",value:function(o){return this.spec.stopEvent?this.spec.stopEvent(o):!1}},{key:"ignoreMutation",value:function(o){return this.spec.ignoreMutation?this.spec.ignoreMutation(o):L(E(t.prototype),"ignoreMutation",this).call(this,o)}}]),t}(Pe);function nn(e,r,t){for(var n=e.firstChild,o=!1,i=0;i<r.length;i++){var s=r[i],a=s.dom;if(a.parentNode==e){for(;a!=n;)n=Ot(n),o=!0;n=n.nextSibling}else o=!0,e.insertBefore(a,n);if(s instanceof Ae){var l=n?n.previousSibling:e.lastChild;nn(s.contentDOM,s.children,t),n=l?l.nextSibling:e.firstChild}}for(;n;)n=Ot(n),o=!0;o&&t.trackWrites==e&&(t.trackWrites=null)}var Oe=function(r){r&&(this.nodeName=r)};Oe.prototype=Object.create(null);var se=[new Oe];function Qe(e,r,t){if(e.length==0)return se;for(var n=t?se[0]:new Oe,o=[n],i=0;i<e.length;i++){var s=e[i].type.attrs;if(!!s){s.nodeName&&o.push(n=new Oe(s.nodeName));for(var a in s){var l=s[a];l!=null&&(t&&o.length==1&&o.push(n=new Oe(r.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return o}function rn(e,r,t,n){if(t==se&&n==se)return r;for(var o=r,i=0;i<n.length;i++){var s=n[i],a=t[i];if(i){var l=void 0;a&&a.nodeName==s.nodeName&&o!=e&&(l=o.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(o),a=se[0]),o=l}er(o,a||se[0],s)}return o}function er(e,r,t){for(var n in r)n!="class"&&n!="style"&&n!="nodeName"&&!(n in t)&&e.removeAttribute(n);for(var o in t)o!="class"&&o!="style"&&o!="nodeName"&&t[o]!=r[o]&&e.setAttribute(o,t[o]);if(r.class!=t.class){for(var i=r.class?r.class.split(" ").filter(Boolean):[],s=t.class?t.class.split(" ").filter(Boolean):[],a=0;a<i.length;a++)s.indexOf(i[a])==-1&&e.classList.remove(i[a]);for(var l=0;l<s.length;l++)i.indexOf(s[l])==-1&&e.classList.add(s[l]);e.classList.length==0&&e.removeAttribute("class")}if(r.style!=t.style){if(r.style)for(var u=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,c;c=u.exec(r.style);)e.style.removeProperty(c[1]);t.style&&(e.style.cssText+=t.style)}}function on(e,r,t){return rn(e,e,se,Qe(r,t,e.nodeType!=1))}function Ze(e,r){if(e.length!=r.length)return!1;for(var t=0;t<e.length;t++)if(!e[t].type.eq(r[t].type))return!1;return!0}function Ot(e){var r=e.nextSibling;return e.parentNode.removeChild(e),r}var tr=function(){function e(r,t){M(this,e),this.lock=t,this.index=0,this.stack=[],this.changed=!1,this.top=r,this.preMatch=nr(r.node.content,r)}return T(e,[{key:"destroyBetween",value:function(t,n){if(t!=n){for(var o=t;o<n;o++)this.top.children[o].destroy();this.top.children.splice(t,n-t),this.changed=!0}}},{key:"destroyRest",value:function(){this.destroyBetween(this.index,this.top.children.length)}},{key:"syncToMarks",value:function(t,n,o){for(var i=0,s=this.stack.length>>1,a=Math.min(s,t.length);i<a&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(t[i])&&t[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=H,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<t.length;){this.stack.push(this.top,this.index+1);for(var l=-1,u=this.index;u<Math.min(this.index+3,this.top.children.length);u++)if(this.top.children[u].matchesMark(t[s])){l=u;break}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{var c=Ae.create(this.top,t[s],n,o);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,s++}}},{key:"findNodeMatch",value:function(t,n,o,i){var s=-1,a;if(i>=this.preMatch.index&&(a=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&a.matchesNode(t,n,o))s=this.top.children.indexOf(a,this.index);else for(var l=this.index,u=Math.min(this.top.children.length,l+5);l<u;l++){var c=this.top.children[l];if(c.matchesNode(t,n,o)&&!this.preMatch.matched.has(c)){s=l;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}},{key:"updateNodeAt",value:function(t,n,o,i,s){var a=this.top.children[i];return a.dirty==J&&a.dom==a.contentDOM&&(a.dirty=ve),a.update(t,n,o,s)?(this.destroyBetween(this.index,i),this.index=i+1,!0):!1}},{key:"findIndexWithChild",value:function(t){for(;;){var n=t.parentNode;if(!n)return-1;if(n==this.top.contentDOM){var o=t.pmViewDesc;if(o){for(var i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==o)return i}return-1}t=n}}},{key:"updateNextNode",value:function(t,n,o,i,s){for(var a=this.index;a<this.top.children.length;a++){var l=this.top.children[a];if(l instanceof Pe){var u=this.preMatch.matched.get(l);if(u!=null&&u!=s)return!1;var c=l.dom,f=this.lock&&(c==this.lock||c.nodeType==1&&c.contains(this.lock.parentNode))&&!(t.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==t.text&&l.dirty!=J&&Ze(n,l.outerDeco));if(!f&&l.update(t,n,o,i))return this.destroyBetween(this.index,a),l.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1}},{key:"addNode",value:function(t,n,o,i,s){this.top.children.splice(this.index++,0,Pe.create(this.top,t,n,o,i,s)),this.changed=!0}},{key:"placeWidget",value:function(t,n,o){var i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(t)&&(t==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{var s=new _t(this.top,t,n,o);this.top.children.splice(this.index++,0,s),this.changed=!0}}},{key:"addTextblockHacks",value:function(){for(var t=this.top.children[this.index-1],n=this.top;t instanceof Ae;)n=t,t=n.children[n.children.length-1];(!t||!(t instanceof en)||/\n$/.test(t.node.text))&&((F||A)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}},{key:"addHackNode",value:function(t,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(t))this.index++;else{var o=document.createElement(t);t=="IMG"&&(o.className="ProseMirror-separator",o.alt=""),t=="BR"&&(o.className="ProseMirror-trailingBreak");var i=new tn(this.top,[],o,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}}]),e}();function nr(e,r){var t=r,n=t.children.length,o=e.childCount,i=new Map,s=[];e:for(;o>0;){for(var a=void 0;;)if(n){var l=t.children[n-1];if(l instanceof Ae)t=l,n=l.children.length;else{a=l,n--;break}}else{if(t==r)break e;n=t.parent.children.indexOf(t),t=t.parent}var u=a.node;if(!!u){if(u!=e.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}function rr(e,r){return e.type.side-r.type.side}function or(e,r,t,n){var o=r.locals(e),i=0;if(o.length==0){for(var s=0;s<e.childCount;s++){var a=e.child(s);n(a,o,r.forChild(i,a),s),i+=a.nodeSize}return}for(var l=0,u=[],c=null,f=0;;){if(l<o.length&&o[l].to==i){for(var d=o[l++],h=void 0;l<o.length&&o[l].to==i;)(h||(h=[d])).push(o[l++]);if(h){h.sort(rr);for(var p=0;p<h.length;p++)t(h[p],f,!!c)}else t(d,f,!!c)}var g=void 0,D=void 0;if(c)D=-1,g=c,c=null;else if(f<e.childCount)D=f,g=e.child(f++);else break;for(var v=0;v<u.length;v++)u[v].to<=i&&u.splice(v--,1);for(;l<o.length&&o[l].from<=i&&o[l].to>i;)u.push(o[l++]);var m=i+g.nodeSize;if(g.isText){var S=m;l<o.length&&o[l].from<S&&(S=o[l].from);for(var k=0;k<u.length;k++)u[k].to<S&&(S=u[k].to);S<m&&(c=g.cut(S-i),g=g.cut(0,S-i),m=S,D=-1)}var b=g.isInline&&!g.isLeaf?u.filter(function(N){return!N.inline}):u.slice();n(g,b,r.forChild(i,g),D),i=m}}function ir(e){if(e.nodeName=="UL"||e.nodeName=="OL"){var r=e.style.cssText;e.style.cssText=r+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=r}}function sr(e,r){for(;;){if(e.nodeType==3)return e;if(e.nodeType==1&&r>0){if(e.childNodes.length>r&&e.childNodes[r].nodeType==3)return e.childNodes[r];e=e.childNodes[r-1],r=G(e)}else if(e.nodeType==1&&r<e.childNodes.length)e=e.childNodes[r],r=0;else return null}}function ar(e,r,t,n){for(var o=0,i=0;o<e.childCount&&i<=n;){var s=e.child(o++),a=i;if(i+=s.nodeSize,!!s.isText){for(var l=s.text;o<e.childCount;){var u=e.child(o++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=t){var c=a<n?l.lastIndexOf(r,n-a-1):-1;if(c>=0&&c+r.length+a>=t)return a+c;if(t==n&&l.length>=n+r.length-a&&l.slice(n-a,n-a+r.length)==r)return n}}}return-1}function Xe(e,r,t,n,o){for(var i=[],s=0,a=0;s<e.length;s++){var l=e[s],u=a,c=a+=l.size;u>=t||c<=r?i.push(l):(u<r&&i.push(l.slice(0,r-u,n)),o&&(i.push(o),o=void 0),c>t&&i.push(l.slice(t-u,l.size,n)))}return i}function sn(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=e.domSelection(),n=e.state.doc;if(!t.focusNode)return null;var o=e.docView.nearestDesc(t.focusNode),i=o&&o.size==0,s=e.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(s<0)return null;var a=n.resolve(s),l,u;if(rt(t)){for(l=a;o&&!o.node;)o=o.parent;var c=o.node;if(o&&c.isAtom&&y.NodeSelection.isSelectable(c)&&o.parent&&!(c.isInline&&In(t.focusNode,t.focusOffset,o.dom))){var f=o.posBefore;u=new y.NodeSelection(s==f?a:n.resolve(f))}}else{var d=e.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(d<0)return null;l=n.resolve(d)}if(!u){var h=r=="pointer"||e.state.selection.head<a.pos&&!i?1:-1;u=it(e,l,a,h)}return u}function an(e){return e.editable?e.hasFocus():un(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function te(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e.state.selection;if(ln(e,t),!!an(e)){if(!r&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&A){var n=e.domSelection(),o=e.domObserver.currentSelection;if(n.anchorNode&&o.anchorNode&&Te(n.anchorNode,n.anchorOffset,o.anchorNode,o.anchorOffset)){e.input.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)ur(e);else{var i=t.anchor,s=t.head,a,l;Ct&&!(t instanceof y.TextSelection)&&(t.$from.parent.inlineContent||(a=Mt(e,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(l=Mt(e,t.to))),e.docView.setSelection(i,s,e.root,r),Ct&&(a&&Tt(a),l&&Tt(l)),t.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&lr(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}var Ct=F||A&&An<63;function Mt(e,r){var t=e.docView.domFromPos(r,0),n=t.node,o=t.offset,i=o<n.childNodes.length?n.childNodes[o]:null,s=o?n.childNodes[o-1]:null;if(F&&i&&i.contentEditable=="false")return qe(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return qe(i);if(s)return qe(s)}}function qe(e){return e.contentEditable="true",F&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Tt(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function lr(e){var r=e.dom.ownerDocument;r.removeEventListener("selectionchange",e.input.hideSelectionGuard);var t=e.domSelection(),n=t.anchorNode,o=t.anchorOffset;r.addEventListener("selectionchange",e.input.hideSelectionGuard=function(){(t.anchorNode!=n||t.anchorOffset!=o)&&(r.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout(function(){(!an(e)||e.state.selection.visible)&&e.dom.classList.remove("ProseMirror-hideselection")},20))})}function ur(e){var r=e.domSelection(),t=document.createRange(),n=e.cursorWrapper.dom,o=n.nodeName=="IMG";o?t.setEnd(n.parentNode,q(n)+1):t.setEnd(n,0),t.collapse(!1),r.removeAllRanges(),r.addRange(t),!o&&!e.state.selection.visible&&$&&_<=11&&(n.disabled=!0,n.disabled=!1)}function ln(e,r){if(r instanceof y.NodeSelection){var t=e.docView.descAt(r.from);t!=e.lastSelectedViewDesc&&(Pt(e),t&&t.selectNode(),e.lastSelectedViewDesc=t)}else Pt(e)}function Pt(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function it(e,r,t,n){return e.someProp("createSelectionBetween",function(o){return o(e,r,t)})||y.TextSelection.between(r,t,n)}function Vt(e){return e.editable&&e.root.activeElement!=e.dom?!1:un(e)}function un(e){var r=e.domSelection();if(!r.anchorNode)return!1;try{return e.dom.contains(r.anchorNode.nodeType==3?r.anchorNode.parentNode:r.anchorNode)&&(e.editable||e.dom.contains(r.focusNode.nodeType==3?r.focusNode.parentNode:r.focusNode))}catch{return!1}}function cr(e){var r=e.docView.domFromPos(e.state.selection.anchor,0),t=e.domSelection();return Te(r.node,r.offset,t.anchorNode,t.anchorOffset)}function je(e,r){var t=e.selection,n=t.$anchor,o=t.$head,i=r>0?n.max(o):n.min(o),s=i.parent.inlineContent?i.depth?e.doc.resolve(r>0?i.after():i.before()):null:i;return s&&y.Selection.findFrom(s,r)}function ie(e,r){return e.dispatch(e.state.tr.setSelection(r).scrollIntoView()),!0}function xt(e,r,t){var n=e.state.selection;if(n instanceof y.TextSelection){if(!n.empty||t.indexOf("s")>-1)return!1;if(e.endOfTextblock(r>0?"right":"left")){var o=je(e.state,r);return o&&o instanceof y.NodeSelection?ie(e,o):!1}else if(!(W&&t.indexOf("m")>-1)){var i=n.$head,s=i.textOffset?null:r<0?i.nodeBefore:i.nodeAfter,a;if(!s||s.isText)return!1;var l=r<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(a=e.docView.descAt(l))&&!a.contentDOM?y.NodeSelection.isSelectable(s)?ie(e,new y.NodeSelection(r<0?e.state.doc.resolve(i.pos-s.nodeSize):i)):Ie?ie(e,new y.TextSelection(e.state.doc.resolve(r<0?l:l+s.nodeSize))):!1:!1}}else{if(n instanceof y.NodeSelection&&n.node.isInline)return ie(e,new y.TextSelection(r>0?n.$to:n.$from));var u=je(e.state,r);return u?ie(e,u):!1}}function Re(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function Ce(e){var r=e.pmViewDesc;return r&&r.size==0&&(e.nextSibling||e.nodeName!="BR")}function $e(e){var r=e.domSelection(),t=r.focusNode,n=r.focusOffset;if(!!t){var o,i,s=!1;for(Y&&t.nodeType==1&&n<Re(t)&&Ce(t.childNodes[n])&&(s=!0);;)if(n>0){if(t.nodeType!=1)break;var a=t.childNodes[n-1];if(Ce(a))o=t,i=--n;else if(a.nodeType==3)t=a,n=t.nodeValue.length;else break}else{if(cn(t))break;for(var l=t.previousSibling;l&&Ce(l);)o=t.parentNode,i=q(l),l=l.previousSibling;if(l)t=l,n=Re(t);else{if(t=t.parentNode,t==e.dom)break;n=0}}s?we(e,r,t,n):o&&we(e,r,o,i)}}function Ke(e){var r=e.domSelection(),t=r.focusNode,n=r.focusOffset;if(!!t){for(var o=Re(t),i,s;;)if(n<o){if(t.nodeType!=1)break;var a=t.childNodes[n];if(Ce(a))i=t,s=++n;else break}else{if(cn(t))break;for(var l=t.nextSibling;l&&Ce(l);)i=l.parentNode,s=q(l)+1,l=l.nextSibling;if(l)t=l,n=0,o=Re(t);else{if(t=t.parentNode,t==e.dom)break;n=o=0}}i&&we(e,r,i,s)}}function cn(e){var r=e.pmViewDesc;return r&&r.node&&r.node.isBlock}function we(e,r,t,n){if(rt(r)){var o=document.createRange();o.setEnd(t,n),o.setStart(t,n),r.removeAllRanges(),r.addRange(o)}else r.extend&&r.extend(t,n);e.domObserver.setCurSelection();var i=e.state;setTimeout(function(){e.state==i&&te(e)},50)}function Et(e,r,t){var n=e.state.selection;if(n instanceof y.TextSelection&&!n.empty||t.indexOf("s")>-1||W&&t.indexOf("m")>-1)return!1;var o=n.$from,i=n.$to;if(!o.parent.inlineContent||e.endOfTextblock(r<0?"up":"down")){var s=je(e.state,r);if(s&&s instanceof y.NodeSelection)return ie(e,s)}if(!o.parent.inlineContent){var a=r<0?o:i,l=n instanceof y.AllSelection?y.Selection.near(a,r):y.Selection.findFrom(a,r);return l?ie(e,l):!1}return!1}function At(e,r){if(!(e.state.selection instanceof y.TextSelection))return!0;var t=e.state.selection,n=t.$head,o=t.$anchor,i=t.empty;if(!n.sameParent(o))return!0;if(!i)return!1;if(e.endOfTextblock(r>0?"forward":"backward"))return!0;var s=!n.textOffset&&(r<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){var a=e.state.tr;return r<0?a.delete(n.pos-s.nodeSize,n.pos):a.delete(n.pos,n.pos+s.nodeSize),e.dispatch(a),!0}return!1}function Rt(e,r,t){e.domObserver.stop(),r.contentEditable=t,e.domObserver.start()}function fr(e){if(!F||e.state.selection.$head.parentOffset>0)return!1;var r=e.domSelection(),t=r.focusNode,n=r.focusOffset;if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable=="false"){var o=t.firstChild;Rt(e,o,"true"),setTimeout(function(){return Rt(e,o,"false")},20)}return!1}function dr(e){var r="";return e.ctrlKey&&(r+="c"),e.metaKey&&(r+="m"),e.altKey&&(r+="a"),e.shiftKey&&(r+="s"),r}function hr(e,r){var t=r.keyCode,n=dr(r);return t==8||W&&t==72&&n=="c"?At(e,-1)||$e(e):t==46||W&&t==68&&n=="c"?At(e,1)||Ke(e):t==13||t==27?!0:t==37||W&&t==66&&n=="c"?xt(e,-1,n)||$e(e):t==39||W&&t==70&&n=="c"?xt(e,1,n)||Ke(e):t==38||W&&t==80&&n=="c"?Et(e,-1,n)||$e(e):t==40||W&&t==78&&n=="c"?fr(e)||Et(e,1,n)||Ke(e):n==(W?"m":"c")&&(t==66||t==73||t==89||t==90)}function st(e,r){for(var t=[],n=r.content,o=r.openStart,i=r.openEnd;o>1&&i>1&&n.childCount==1&&n.firstChild.childCount==1;){o--,i--;var s=n.firstChild;t.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),n=s.content}var a=e.someProp("clipboardSerializer")||O.DOMSerializer.fromSchema(e.state.schema),l=mn(),u=l.createElement("div");u.appendChild(a.serializeFragment(n,{document:l}));for(var c=u.firstChild,f,d=0;c&&c.nodeType==1&&(f=pn[c.nodeName.toLowerCase()]);){for(var h=f.length-1;h>=0;h--){for(var p=l.createElement(f[h]);u.firstChild;)p.appendChild(u.firstChild);u.appendChild(p),d++}c=u.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice","".concat(o," ").concat(i).concat(d?" -".concat(d):""," ").concat(JSON.stringify(t)));var g=e.someProp("clipboardTextSerializer",function(D){return D(r)})||r.content.textBetween(0,r.content.size,`

`);return{dom:u,text:g}}function at(e,r,t,n,o){var i=o.parent.type.spec.code,s,a;if(!t&&!r)return null;var l=r&&(n||i||!t);if(l){if(e.someProp("transformPastedText",function(b){r=b(r,i||n)}),i)return r?new O.Slice(O.Fragment.from(e.state.schema.text(r.replace(/\r\n?/g,`
`))),0,0):O.Slice.empty;var u=e.someProp("clipboardTextParser",function(b){return b(r,o,n)});if(u)a=u;else{var c=o.marks(),f=e.state.schema,d=O.DOMSerializer.fromSchema(f);s=document.createElement("div"),r.split(/(?:\r\n?|\n)+/).forEach(function(b){var N=s.appendChild(document.createElement("p"));b&&N.appendChild(d.serializeNode(f.text(b,c)))})}}else e.someProp("transformPastedHTML",function(b){t=b(t)}),s=gr(t),Ie&&vr(s);var h=s&&s.querySelector("[data-pm-slice]"),p=h&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(h.getAttribute("data-pm-slice")||"");if(p&&p[3])for(var g=+p[3];g>0&&s.firstChild;g--)s=s.firstChild;if(!a){var D=e.someProp("clipboardParser")||e.someProp("domParser")||O.DOMParser.fromSchema(e.state.schema);a=D.parseSlice(s,{preserveWhitespace:!!(l||p),context:o,ruleFromNode:function(N){return N.nodeName=="BR"&&!N.nextSibling&&N.parentNode&&!pr.test(N.parentNode.nodeName)?{ignore:!0}:null}})}if(p)a=yr(Ft(a,+p[1],+p[2]),p[4]);else if(a=O.Slice.maxOpen(mr(a.content,o),!0),a.openStart||a.openEnd){for(var v=0,m=0,S=a.content.firstChild;v<a.openStart&&!S.type.spec.isolating;v++,S=S.firstChild);for(var k=a.content.lastChild;m<a.openEnd&&!k.type.spec.isolating;m++,k=k.lastChild);a=Ft(a,v,m)}return e.someProp("transformPasted",function(b){a=b(a)}),a}var pr=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function mr(e,r){if(e.childCount<2)return e;for(var t=function(s){var a=r.node(s),l=a.contentMatchAt(r.index(s)),u=void 0,c=[];if(e.forEach(function(f){if(!!c){var d=l.findWrapping(f.type),h;if(!d)return c=null;if(h=c.length&&u.length&&dn(d,u,f,c[c.length-1],0))c[c.length-1]=h;else{c.length&&(c[c.length-1]=hn(c[c.length-1],u.length));var p=fn(f,d);c.push(p),l=l.matchType(p.type),u=d}}}),c)return{v:O.Fragment.from(c)}},n=r.depth;n>=0;n--){var o=t(n);if(ke(o)==="object")return o.v}return e}function fn(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=r.length-1;n>=t;n--)e=r[n].create(null,O.Fragment.from(e));return e}function dn(e,r,t,n,o){if(o<e.length&&o<r.length&&e[o]==r[o]){var i=dn(e,r,t,n.lastChild,o+1);if(i)return n.copy(n.content.replaceChild(n.childCount-1,i));var s=n.contentMatchAt(n.childCount);if(s.matchType(o==e.length-1?t.type:e[o+1]))return n.copy(n.content.append(O.Fragment.from(fn(t,e,o+1))))}}function hn(e,r){if(r==0)return e;var t=e.content.replaceChild(e.childCount-1,hn(e.lastChild,r-1)),n=e.contentMatchAt(e.childCount).fillBefore(O.Fragment.empty,!0);return e.copy(t.append(n))}function _e(e,r,t,n,o,i){var s=r<0?e.firstChild:e.lastChild,a=s.content;return o<n-1&&(a=_e(a,r,t,n,o+1,i)),o>=t&&(a=r<0?s.contentMatchAt(0).fillBefore(a,e.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(O.Fragment.empty,!0))),e.replaceChild(r<0?0:e.childCount-1,s.copy(a))}function Ft(e,r,t){return r<e.openStart&&(e=new O.Slice(_e(e.content,-1,r,e.openStart,0,e.openEnd),r,e.openEnd)),t<e.openEnd&&(e=new O.Slice(_e(e.content,1,t,e.openEnd,0,0),e.openStart,t)),e}var pn={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},It=null;function mn(){return It||(It=document.implementation.createHTMLDocument("title"))}function gr(e){var r=/^(\s*<meta [^>]*>)*/.exec(e);r&&(e=e.slice(r[0].length));var t=mn().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(e),o;if((o=n&&pn[n[1].toLowerCase()])&&(e=o.map(function(s){return"<"+s+">"}).join("")+e+o.map(function(s){return"</"+s+">"}).reverse().join("")),t.innerHTML=e,o)for(var i=0;i<o.length;i++)t=t.querySelector(o[i])||t;return t}function vr(e){for(var r=e.querySelectorAll(A?"span:not([class]):not([style])":"span.Apple-converted-space"),t=0;t<r.length;t++){var n=r[t];n.childNodes.length==1&&n.textContent=="\xA0"&&n.parentNode&&n.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),n)}}function yr(e,r){if(!e.size)return e;var t=e.content.firstChild.type.schema,n;try{n=JSON.parse(r)}catch{return e}for(var o=e.content,i=e.openStart,s=e.openEnd,a=n.length-2;a>=0;a-=2){var l=t.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;o=O.Fragment.from(l.create(n[a+1],o)),i++,s++}return new O.Slice(o,i,s)}var I={},R={},kr=T(function e(){M(this,e),this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null});function br(e){var r=function(o){var i=I[o];e.dom.addEventListener(o,e.input.eventHandlers[o]=function(s){Sr(e,s)&&!lt(e,s)&&(e.editable||!(s.type in R))&&i(e,s)})};for(var t in I)r(t);F&&e.dom.addEventListener("input",function(){return null}),et(e)}function ae(e,r){e.input.lastSelectionOrigin=r,e.input.lastSelectionTime=Date.now()}function Dr(e){e.domObserver.stop();for(var r in e.input.eventHandlers)e.dom.removeEventListener(r,e.input.eventHandlers[r]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}function et(e){e.someProp("handleDOMEvents",function(r){for(var t in r)e.input.eventHandlers[t]||e.dom.addEventListener(t,e.input.eventHandlers[t]=function(n){return lt(e,n)})})}function lt(e,r){return e.someProp("handleDOMEvents",function(t){var n=t[r.type];return n?n(e,r)||r.defaultPrevented:!1})}function Sr(e,r){if(!r.bubbles)return!0;if(r.defaultPrevented)return!1;for(var t=r.target;t!=e.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(r))return!1;return!0}function Nr(e,r){!lt(e,r)&&I[r.type]&&(e.editable||!(r.type in R))&&I[r.type](e,r)}R.keydown=function(e,r){var t=r;if(e.input.shiftKey=t.keyCode==16||t.shiftKey,!vn(e,t)&&(e.input.lastKeyCode=t.keyCode,e.input.lastKeyCodeTime=Date.now(),!(U&&A&&t.keyCode==13)))if(t.keyCode!=229&&e.domObserver.forceFlush(),be&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n=Date.now();e.input.lastIOSEnter=n,e.input.lastIOSEnterFallbackTimeout=setTimeout(function(){e.input.lastIOSEnter==n&&(e.someProp("handleKeyDown",function(o){return o(e,ge(13,"Enter"))}),e.input.lastIOSEnter=0)},200)}else e.someProp("handleKeyDown",function(o){return o(e,t)})||hr(e,t)?t.preventDefault():ae(e,"key")};R.keyup=function(e,r){r.keyCode==16&&(e.input.shiftKey=!1)};R.keypress=function(e,r){var t=r;if(!(vn(e,t)||!t.charCode||t.ctrlKey&&!t.altKey||W&&t.metaKey)){if(e.someProp("handleKeyPress",function(i){return i(e,t)})){t.preventDefault();return}var n=e.state.selection;if(!(n instanceof y.TextSelection)||!n.$from.sameParent(n.$to)){var o=String.fromCharCode(t.charCode);e.someProp("handleTextInput",function(i){return i(e,n.$from.pos,n.$to.pos,o)})||e.dispatch(e.state.tr.insertText(o).scrollIntoView()),t.preventDefault()}}};function Be(e){return{left:e.clientX,top:e.clientY}}function Or(e,r){var t=r.x-e.clientX,n=r.y-e.clientY;return t*t+n*n<100}function ut(e,r,t,n,o){if(n==-1)return!1;for(var i=e.state.doc.resolve(n),s=function(c){if(e.someProp(r,function(f){return c>i.depth?f(e,t,i.nodeAfter,i.before(c),o,!0):f(e,t,i.node(c),i.before(c),o,!1)}))return{v:!0}},a=i.depth+1;a>0;a--){var l=s(a);if(ke(l)==="object")return l.v}return!1}function ye(e,r,t){e.focused||e.focus();var n=e.state.tr.setSelection(r);t=="pointer"&&n.setMeta("pointer",!0),e.dispatch(n)}function Cr(e,r){if(r==-1)return!1;var t=e.state.doc.resolve(r),n=t.nodeAfter;return n&&n.isAtom&&y.NodeSelection.isSelectable(n)?(ye(e,new y.NodeSelection(t),"pointer"),!0):!1}function Mr(e,r){if(r==-1)return!1;var t=e.state.selection,n,o;t instanceof y.NodeSelection&&(n=t.node);for(var i=e.state.doc.resolve(r),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(y.NodeSelection.isSelectable(a)){n&&t.$from.depth>0&&s>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?o=i.before(t.$from.depth):o=i.before(s);break}}return o!=null?(ye(e,y.NodeSelection.create(e.state.doc,o),"pointer"),!0):!1}function Tr(e,r,t,n,o){return ut(e,"handleClickOn",r,t,n)||e.someProp("handleClick",function(i){return i(e,r,n)})||(o?Mr(e,t):Cr(e,t))}function Pr(e,r,t,n){return ut(e,"handleDoubleClickOn",r,t,n)||e.someProp("handleDoubleClick",function(o){return o(e,r,n)})}function Vr(e,r,t,n){return ut(e,"handleTripleClickOn",r,t,n)||e.someProp("handleTripleClick",function(o){return o(e,r,n)})||xr(e,t,n)}function xr(e,r,t){if(t.button!=0)return!1;var n=e.state.doc;if(r==-1)return n.inlineContent?(ye(e,y.TextSelection.create(n,0,n.content.size),"pointer"),!0):!1;for(var o=n.resolve(r),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)ye(e,y.TextSelection.create(n,a+1,a+1+s.content.size),"pointer");else if(y.NodeSelection.isSelectable(s))ye(e,y.NodeSelection.create(n,a),"pointer");else continue;return!0}}function ct(e){return Ve(e)}var gn=W?"metaKey":"ctrlKey";I.mousedown=function(e,r){var t=r;e.input.shiftKey=t.shiftKey;var n=ct(e),o=Date.now(),i="singleClick";o-e.input.lastClick.time<500&&Or(t,e.input.lastClick)&&!t[gn]&&(e.input.lastClick.type=="singleClick"?i="doubleClick":e.input.lastClick.type=="doubleClick"&&(i="tripleClick")),e.input.lastClick={time:o,x:t.clientX,y:t.clientY,type:i};var s=e.posAtCoords(Be(t));!s||(i=="singleClick"?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new Er(e,s,t,!!n)):(i=="doubleClick"?Pr:Vr)(e,s.pos,s.inside,t)?t.preventDefault():ae(e,"pointer"))};var Er=function(){function e(r,t,n,o){var i=this;M(this,e),this.view=r,this.pos=t,this.event=n,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=r.state.doc,this.selectNode=!!n[gn],this.allowDefault=n.shiftKey;var s,a;if(t.inside>-1)s=r.state.doc.nodeAt(t.inside),a=t.inside;else{var l=r.state.doc.resolve(t.pos);s=l.parent,a=l.depth?l.before():0}var u=o?null:n.target,c=u?r.docView.nearestDesc(u,!0):null;this.target=c?c.dom:null;var f=r.state.selection;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||f instanceof y.NodeSelection&&f.from<=a&&f.to>a)&&(this.mightDrag={node:s,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Y&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){i.view.input.mouseDown==i&&i.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),r.root.addEventListener("mouseup",this.up=this.up.bind(this)),r.root.addEventListener("mousemove",this.move=this.move.bind(this)),ae(r,"pointer")}return T(e,[{key:"done",value:function(){var t=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return te(t.view)}),this.view.input.mouseDown=null}},{key:"up",value:function(t){if(this.done(),!!this.view.dom.contains(t.target)){var n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Be(t))),this.allowDefault||!n?ae(this.view,"pointer"):Tr(this.view,n.pos,n.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||F&&this.mightDrag&&!this.mightDrag.node.isAtom||A&&!(this.view.state.selection instanceof y.TextSelection)&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(ye(this.view,y.Selection.near(this.view.state.doc.resolve(n.pos)),"pointer"),t.preventDefault()):ae(this.view,"pointer")}}},{key:"move",value:function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),ae(this.view,"pointer"),t.buttons==0&&this.done()}}]),e}();I.touchdown=function(e){ct(e),ae(e,"pointer")};I.contextmenu=function(e){return ct(e)};function vn(e,r){return e.composing?!0:F&&Math.abs(r.timeStamp-e.input.compositionEndedAt)<500?(e.input.compositionEndedAt=-2e8,!0):!1}var Ar=U?5e3:-1;R.compositionstart=R.compositionupdate=function(e){if(!e.composing){e.domObserver.flush();var r=e.state,t=r.selection.$from;if(r.selection.empty&&(r.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(function(a){return a.type.spec.inclusive===!1})))e.markCursor=e.state.storedMarks||t.marks(),Ve(e,!0),e.markCursor=null;else if(Ve(e),Y&&r.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length)for(var n=e.domSelection(),o=n.focusNode,i=n.focusOffset;o&&o.nodeType==1&&i!=0;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(s.nodeType==3){n.collapse(s,s.nodeValue.length);break}else o=s,i=-1}e.input.composing=!0}yn(e,Ar)};R.compositionend=function(e,r){e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=r.timeStamp,yn(e,20))};function yn(e,r){clearTimeout(e.input.composingTimeout),r>-1&&(e.input.composingTimeout=setTimeout(function(){return Ve(e)},r))}function kn(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=Rr());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function Rr(){var e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}function Ve(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(U&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),kn(e),r||e.docView&&e.docView.dirty){var t=sn(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}function Fr(e,r){if(!!e.dom.parentNode){var t=e.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(r),t.style.cssText="position: fixed; left: -10000px; top: 10px";var n=getSelection(),o=document.createRange();o.selectNodeContents(r),e.dom.blur(),n.removeAllRanges(),n.addRange(o),setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),e.focus()},50)}}var De=$&&_<15||be&&Rn<604;I.copy=R.cut=function(e,r){var t=r,n=e.state.selection,o=t.type=="cut";if(!n.empty){var i=De?null:t.clipboardData,s=n.content(),a=st(e,s),l=a.dom,u=a.text;i?(t.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",u)):Fr(e,l),o&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function Ir(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function Br(e,r){if(!!e.dom.parentNode){var t=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,n=e.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(function(){e.focus(),n.parentNode&&n.parentNode.removeChild(n),t?tt(e,n.value,null,r):tt(e,n.textContent,n.innerHTML,r)},50)}}function tt(e,r,t,n){var o=at(e,r,t,e.input.shiftKey,e.state.selection.$from);if(e.someProp("handlePaste",function(a){return a(e,n,o||O.Slice.empty)}))return!0;if(!o)return!1;var i=Ir(o),s=i?e.state.tr.replaceSelectionWith(i,e.input.shiftKey):e.state.tr.replaceSelection(o);return e.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}R.paste=function(e,r){var t=r;if(!(e.composing&&!U)){var n=De?null:t.clipboardData;n&&tt(e,n.getData("text/plain"),n.getData("text/html"),t)?t.preventDefault():Br(e,t)}};var zr=T(function e(r,t){M(this,e),this.slice=r,this.move=t}),bn=W?"altKey":"ctrlKey";I.dragstart=function(e,r){var t=r,n=e.input.mouseDown;if(n&&n.done(),!!t.dataTransfer){var o=e.state.selection,i=o.empty?null:e.posAtCoords(Be(t));if(!(i&&i.pos>=o.from&&i.pos<=(o instanceof y.NodeSelection?o.to-1:o.to))){if(n&&n.mightDrag)e.dispatch(e.state.tr.setSelection(y.NodeSelection.create(e.state.doc,n.mightDrag.pos)));else if(t.target&&t.target.nodeType==1){var s=e.docView.nearestDesc(t.target,!0);s&&s.node.type.spec.draggable&&s!=e.docView&&e.dispatch(e.state.tr.setSelection(y.NodeSelection.create(e.state.doc,s.posBefore)))}}var a=e.state.selection.content(),l=st(e,a),u=l.dom,c=l.text;t.dataTransfer.clearData(),t.dataTransfer.setData(De?"Text":"text/html",u.innerHTML),t.dataTransfer.effectAllowed="copyMove",De||t.dataTransfer.setData("text/plain",c),e.dragging=new zr(a,!t[bn])}};I.dragend=function(e){var r=e.dragging;window.setTimeout(function(){e.dragging==r&&(e.dragging=null)},50)};R.dragover=R.dragenter=function(e,r){return r.preventDefault()};R.drop=function(e,r){var t=r,n=e.dragging;if(e.dragging=null,!!t.dataTransfer){var o=e.posAtCoords(Be(t));if(!!o){var i=e.state.doc.resolve(o.pos);if(!!i){var s=n&&n.slice;s?e.someProp("transformPasted",function(g){s=g(s)}):s=at(e,t.dataTransfer.getData(De?"Text":"text/plain"),De?null:t.dataTransfer.getData("text/html"),!1,i);var a=!!(n&&!t[bn]);if(e.someProp("handleDrop",function(g){return g(e,t,s||O.Slice.empty,a)})){t.preventDefault();return}if(!!s){t.preventDefault();var l=s?En.dropPoint(e.state.doc,i.pos,s):i.pos;l==null&&(l=i.pos);var u=e.state.tr;a&&u.deleteSelection();var c=u.mapping.map(l),f=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,d=u.doc;if(f?u.replaceRangeWith(c,c,s.content.firstChild):u.replaceRange(c,c,s),!u.doc.eq(d)){var h=u.doc.resolve(c);if(f&&y.NodeSelection.isSelectable(s.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(s.content.firstChild))u.setSelection(new y.NodeSelection(h));else{var p=u.mapping.map(l);u.mapping.maps[u.mapping.maps.length-1].forEach(function(g,D,v,m){return p=m}),u.setSelection(it(e,h,u.doc.resolve(p)))}e.focus(),e.dispatch(u.setMeta("uiEvent","drop"))}}}}}};I.focus=function(e){e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(function(){e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelection())&&te(e)},20))};I.blur=function(e,r){var t=r;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),t.relatedTarget&&e.dom.contains(t.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)};I.beforeinput=function(e,r){var t=r;if(A&&U&&t.inputType=="deleteContentBackward"){e.domObserver.flushSoon();var n=e.input.domChangeCount;setTimeout(function(){if(e.input.domChangeCount==n&&(e.dom.blur(),e.focus(),!e.someProp("handleKeyDown",function(i){return i(e,ge(8,"Backspace"))}))){var o=e.state.selection.$cursor;o&&o.pos>0&&e.dispatch(e.state.tr.delete(o.pos-1,o.pos).scrollIntoView())}},50)}};for(var Bt in R)I[Bt]=R[Bt];function xe(e,r){if(e==r)return!0;for(var t in e)if(e[t]!==r[t])return!1;for(var n in r)if(!(n in e))return!1;return!0}var Lr=function(){function e(r,t){M(this,e),this.toDOM=r,this.spec=t||le,this.side=this.spec.side||0}return T(e,[{key:"map",value:function(t,n,o,i){var s=t.mapResult(n.from+i,this.side<0?-1:1),a=s.pos,l=s.deleted;return l?null:new he(a-o,a-o,this)}},{key:"valid",value:function(){return!0}},{key:"eq",value:function(t){return this==t||t instanceof e&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&xe(this.spec,t.spec))}},{key:"destroy",value:function(t){this.spec.destroy&&this.spec.destroy(t)}}]),e}(),Me=function(){function e(r,t){M(this,e),this.attrs=r,this.spec=t||le}return T(e,[{key:"map",value:function(t,n,o,i){var s=t.map(n.from+i,this.spec.inclusiveStart?-1:1)-o,a=t.map(n.to+i,this.spec.inclusiveEnd?1:-1)-o;return s>=a?null:new he(s,a,this)}},{key:"valid",value:function(t,n){return n.from<n.to}},{key:"eq",value:function(t){return this==t||t instanceof e&&xe(this.attrs,t.attrs)&&xe(this.spec,t.spec)}},{key:"destroy",value:function(){}}],[{key:"is",value:function(t){return t.type instanceof e}}]),e}(),qr=function(){function e(r,t){M(this,e),this.attrs=r,this.spec=t||le}return T(e,[{key:"map",value:function(t,n,o,i){var s=t.mapResult(n.from+i,1);if(s.deleted)return null;var a=t.mapResult(n.to+i,-1);return a.deleted||a.pos<=s.pos?null:new he(s.pos-o,a.pos-o,this)}},{key:"valid",value:function(t,n){var o=t.content.findIndex(n.from),i=o.index,s=o.offset,a;return s==n.from&&!(a=t.child(i)).isText&&s+a.nodeSize==n.to}},{key:"eq",value:function(t){return this==t||t instanceof e&&xe(this.attrs,t.attrs)&&xe(this.spec,t.spec)}},{key:"destroy",value:function(){}}]),e}(),he=function(){function e(r,t,n){M(this,e),this.from=r,this.to=t,this.type=n}return T(e,[{key:"copy",value:function(t,n){return new e(t,n,this.type)}},{key:"eq",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.type.eq(t.type)&&this.from+n==t.from&&this.to+n==t.to}},{key:"map",value:function(t,n,o){return this.type.map(t,this,n,o)}},{key:"spec",get:function(){return this.type.spec}},{key:"inline",get:function(){return this.type instanceof Me}}],[{key:"widget",value:function(t,n,o){return new e(t,t,new Lr(n,o))}},{key:"inline",value:function(t,n,o,i){return new e(t,n,new Me(o,i))}},{key:"node",value:function(t,n,o,i){return new e(t,n,new qr(o,i))}}]),e}(),me=[],le={},X=function(){function e(r,t){M(this,e),this.local=r.length?r:me,this.children=t.length?t:me}return T(e,[{key:"find",value:function(t,n,o){var i=[];return this.findInner(t==null?0:t,n==null?1e9:n,i,0,o),i}},{key:"findInner",value:function(t,n,o,i,s){for(var a=0;a<this.local.length;a++){var l=this.local[a];l.from<=n&&l.to>=t&&(!s||s(l.spec))&&o.push(l.copy(l.from+i,l.to+i))}for(var u=0;u<this.children.length;u+=3)if(this.children[u]<n&&this.children[u+1]>t){var c=this.children[u]+1;this.children[u+2].findInner(t-c,n-c,o,i+c,s)}}},{key:"map",value:function(t,n,o){return this==V||t.maps.length==0?this:this.mapInner(t,n,0,0,o||le)}},{key:"mapInner",value:function(t,n,o,i,s){for(var a,l=0;l<this.local.length;l++){var u=this.local[l].map(t,o,i);u&&u.type.valid(n,u)?(a||(a=[])).push(u):s.onRemove&&s.onRemove(this.local[l].spec)}return this.children.length?$r(this.children,a||[],t,n,o,i,s):a?new e(a.sort(ue),me):V}},{key:"add",value:function(t,n){return n.length?this==V?e.create(t,n):this.addInner(t,n,0):this}},{key:"addInner",value:function(t,n,o){var i=this,s,a=0;t.forEach(function(c,f){var d=f+o,h;if(!!(h=Nn(n,c,d))){for(s||(s=i.children.slice());a<s.length&&s[a]<f;)a+=3;s[a]==f?s[a+2]=s[a+2].addInner(c,h,d+1):s.splice(a,0,f,f+c.nodeSize,Fe(h,c,d+1,le)),a+=3}});for(var l=Sn(a?On(n):n,-o),u=0;u<l.length;u++)l[u].type.valid(t,l[u])||l.splice(u--,1);return new e(l.length?this.local.concat(l).sort(ue):this.local,s||this.children)}},{key:"remove",value:function(t){return t.length==0||this==V?this:this.removeInner(t,0)}},{key:"removeInner",value:function(t,n){for(var o=this.children,i=this.local,s=0;s<o.length;s+=3){for(var a=void 0,l=o[s]+n,u=o[s+1]+n,c=0,f;c<t.length;c++)(f=t[c])&&f.from>l&&f.to<u&&(t[c]=null,(a||(a=[])).push(f));if(!!a){o==this.children&&(o=this.children.slice());var d=o[s+2].removeInner(a,l+1);d!=V?o[s+2]=d:(o.splice(s,3),s-=3)}}if(i.length){for(var h=0,p;h<t.length;h++)if(p=t[h])for(var g=0;g<i.length;g++)i[g].eq(p,n)&&(i==this.local&&(i=this.local.slice()),i.splice(g--,1))}return o==this.children&&i==this.local?this:i.length||o.length?new e(i,o):V}},{key:"forChild",value:function(t,n){if(this==V)return this;if(n.isLeaf)return e.empty;for(var o,i,s=0;s<this.children.length;s+=3)if(this.children[s]>=t){this.children[s]==t&&(o=this.children[s+2]);break}for(var a=t+1,l=a+n.content.size,u=0;u<this.local.length;u++){var c=this.local[u];if(c.from<l&&c.to>a&&c.type instanceof Me){var f=Math.max(a,c.from)-a,d=Math.min(l,c.to)-a;f<d&&(i||(i=[])).push(c.copy(f,d))}}if(i){var h=new e(i.sort(ue),me);return o?new Dn([h,o]):h}return o||V}},{key:"eq",value:function(t){if(this==t)return!0;if(!(t instanceof e)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var n=0;n<this.local.length;n++)if(!this.local[n].eq(t.local[n]))return!1;for(var o=0;o<this.children.length;o+=3)if(this.children[o]!=t.children[o]||this.children[o+1]!=t.children[o+1]||!this.children[o+2].eq(t.children[o+2]))return!1;return!0}},{key:"locals",value:function(t){return ft(this.localsInner(t))}},{key:"localsInner",value:function(t){if(this==V)return me;if(t.inlineContent||!this.local.some(Me.is))return this.local;for(var n=[],o=0;o<this.local.length;o++)this.local[o].type instanceof Me||n.push(this.local[o]);return n}}],[{key:"create",value:function(t,n){return n.length?Fe(n,t,0,le):V}}]),e}();X.empty=new X([],[]);X.removeOverlap=ft;var V=X.empty,Dn=function(){function e(r){M(this,e),this.members=r}return T(e,[{key:"map",value:function(t,n){var o=this.members.map(function(i){return i.map(t,n,le)});return e.from(o)}},{key:"forChild",value:function(t,n){if(n.isLeaf)return X.empty;for(var o=[],i=0;i<this.members.length;i++){var s=this.members[i].forChild(t,n);s!=V&&(s instanceof e?o=o.concat(s.members):o.push(s))}return e.from(o)}},{key:"eq",value:function(t){if(!(t instanceof e)||t.members.length!=this.members.length)return!1;for(var n=0;n<this.members.length;n++)if(!this.members[n].eq(t.members[n]))return!1;return!0}},{key:"locals",value:function(t){for(var n,o=!0,i=0;i<this.members.length;i++){var s=this.members[i].localsInner(t);if(!!s.length)if(!n)n=s;else{o&&(n=n.slice(),o=!1);for(var a=0;a<s.length;a++)n.push(s[a])}}return n?ft(o?n:n.sort(ue)):me}}],[{key:"from",value:function(t){switch(t.length){case 0:return V;case 1:return t[0];default:return new e(t)}}}]),e}();function $r(e,r,t,n,o,i,s){for(var a=e.slice(),l=function(re,oe,Se,Q){for(var C=0;C<a.length;C+=3){var dt=a[C+1],ze=void 0;if(!(dt<0||re>dt+i)){var ht=a[C]+i;oe>=ht?a[C+1]=re<=ht?-2:-1:Se>=o&&(ze=Q-Se-(oe-re))&&(a[C]+=ze,a[C+1]+=ze)}}},u=0;u<t.maps.length;u++)t.maps[u].forEach(l);for(var c=!1,f=0;f<a.length;f+=3)if(a[f+1]<0){if(a[f+1]==-2){c=!0,a[f+1]=-1;continue}var d=t.map(e[f]+i),h=d-o;if(h<0||h>=n.content.size){c=!0;continue}var p=t.map(e[f+1]+i,-1),g=p-o,D=n.content.findIndex(h),v=D.index,m=D.offset,S=n.maybeChild(v);if(S&&m==h&&m+S.nodeSize==g){var k=a[f+2].mapInner(t,S,d+1,e[f]+i+1,s);k!=V?(a[f]=h,a[f+1]=g,a[f+2]=k):(a[f+1]=-2,c=!0)}else c=!0}if(c){var b=Kr(a,e,r,t,o,i,s),N=Fe(b,n,0,s);r=N.local;for(var B=0;B<a.length;B+=3)a[B+1]<0&&(a.splice(B,3),B-=3);for(var K=0,x=0;K<N.children.length;K+=3){for(var z=N.children[K];x<a.length&&a[x]<z;)x+=3;a.splice(x,0,N.children[K],N.children[K+1],N.children[K+2])}}return new X(r.sort(ue),a)}function Sn(e,r){if(!r||!e.length)return e;for(var t=[],n=0;n<e.length;n++){var o=e[n];t.push(new he(o.from+r,o.to+r,o.type))}return t}function Kr(e,r,t,n,o,i,s){function a(u,c){for(var f=0;f<u.local.length;f++){var d=u.local[f].map(n,o,c);d?t.push(d):s.onRemove&&s.onRemove(u.local[f].spec)}for(var h=0;h<u.children.length;h+=3)a(u.children[h+2],u.children[h]+c+1)}for(var l=0;l<e.length;l+=3)e[l+1]==-1&&a(e[l+2],r[l]+i+1);return t}function Nn(e,r,t){if(r.isLeaf)return null;for(var n=t+r.nodeSize,o=null,i=0,s;i<e.length;i++)(s=e[i])&&s.from>t&&s.to<n&&((o||(o=[])).push(s),e[i]=null);return o}function On(e){for(var r=[],t=0;t<e.length;t++)e[t]!=null&&r.push(e[t]);return r}function Fe(e,r,t,n){var o=[],i=!1;r.forEach(function(l,u){var c=Nn(e,l,u+t);if(c){i=!0;var f=Fe(c,l,t+u+1,n);f!=V&&o.push(u,u+l.nodeSize,f)}});for(var s=Sn(i?On(e):e,-t).sort(ue),a=0;a<s.length;a++)s[a].type.valid(r,s[a])||(n.onRemove&&n.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new X(s,o):V}function ue(e,r){return e.from-r.from||e.to-r.to}function ft(e){for(var r=e,t=0;t<r.length-1;t++){var n=r[t];if(n.from!=n.to)for(var o=t+1;o<r.length;o++){var i=r[o];if(i.from==n.from){i.to!=n.to&&(r==e&&(r=e.slice()),r[o]=i.copy(i.from,n.to),zt(r,o+1,i.copy(n.to,i.to)));continue}else{i.from<n.to&&(r==e&&(r=e.slice()),r[t]=n.copy(n.from,i.from),zt(r,o,n.copy(i.from,n.to)));break}}}return r}function zt(e,r,t){for(;r<e.length&&ue(t,e[r])>0;)r++;e.splice(r,0,t)}function We(e){var r=[];return e.someProp("decorations",function(t){var n=t(e.state);n&&n!=V&&r.push(n)}),e.cursorWrapper&&r.push(X.create(e.state.doc,[e.cursorWrapper.deco])),Dn.from(r)}var Wr={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Hr=$&&_<=11,Ur=function(){function e(){M(this,e),this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}return T(e,[{key:"set",value:function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}},{key:"clear",value:function(){this.anchorNode=this.focusNode=null}},{key:"eq",value:function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}]),e}(),Gr=function(){function e(r,t){var n=this;M(this,e),this.view=r,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Ur,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(function(o){for(var i=0;i<o.length;i++)n.queue.push(o[i]);$&&_<=11&&o.some(function(s){return s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length})?n.flushSoon():n.flush()}),Hr&&(this.onCharData=function(o){n.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}return T(e,[{key:"flushSoon",value:function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1,t.flush()},20))}},{key:"forceFlush",value:function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}},{key:"start",value:function(){this.observer&&this.observer.observe(this.view.dom,Wr),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}},{key:"stop",value:function(){var t=this;if(this.observer){var n=this.observer.takeRecords();if(n.length){for(var o=0;o<n.length;o++)this.queue.push(n[o]);window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}},{key:"connectSelection",value:function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}},{key:"disconnectSelection",value:function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}},{key:"suppressSelectionUpdates",value:function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return t.suppressingSelectionUpdates=!1},50)}},{key:"onSelectionChange",value:function(){if(!!Vt(this.view)){if(this.suppressingSelectionUpdates)return te(this.view);if($&&_<=11&&!this.view.state.selection.empty){var t=this.view.domSelection();if(t.focusNode&&Te(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}},{key:"setCurSelection",value:function(){this.currentSelection.set(this.view.domSelection())}},{key:"ignoreSelectionChange",value:function(t){if(t.rangeCount==0)return!0;var n=t.getRangeAt(0).commonAncestorContainer,o=this.view.docView.nearestDesc(n);if(o&&o.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}},{key:"flush",value:function(){if(!(!this.view.docView||this.flushingSoon>-1)){var t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);var n=this.view.domSelection(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Vt(this.view)&&!this.ignoreSelectionChange(n),i=-1,s=-1,a=!1,l=[];if(this.view.editable)for(var u=0;u<t.length;u++){var c=this.registerMutation(t[u],l);c&&(i=i<0?c.from:Math.min(c.from,i),s=s<0?c.to:Math.max(c.to,s),c.typeOver&&(a=!0))}if(Y&&l.length>1){var f=l.filter(function(p){return p.nodeName=="BR"});if(f.length==2){var d=f[0],h=f[1];d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}}(i>-1||o)&&(i>-1&&(this.view.docView.markDirty(i,s),Yr(this.view)),this.handleDOMChange(i,s,a,l),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(n)||te(this.view),this.currentSelection.set(n))}}},{key:"registerMutation",value:function(t,n){if(n.indexOf(t.target)>-1)return null;var o=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(o==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!o||o.ignoreMutation(t))return null;if(t.type=="childList"){for(var i=0;i<t.addedNodes.length;i++)n.push(t.addedNodes[i]);if(o.contentDOM&&o.contentDOM!=o.dom&&!o.contentDOM.contains(t.target))return{from:o.posBefore,to:o.posAfter};var s=t.previousSibling,a=t.nextSibling;if($&&_<=11&&t.addedNodes.length)for(var l=0;l<t.addedNodes.length;l++){var u=t.addedNodes[l],c=u.previousSibling,f=u.nextSibling;(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0)&&(s=c),(!f||Array.prototype.indexOf.call(t.addedNodes,f)<0)&&(a=f)}var d=s&&s.parentNode==t.target?q(s)+1:0,h=o.localPosFromDOM(t.target,d,-1),p=a&&a.parentNode==t.target?q(a):t.target.childNodes.length,g=o.localPosFromDOM(t.target,p,1);return{from:h,to:g}}else return t.type=="attributes"?{from:o.posAtStart-o.border,to:o.posAtEnd+o.border}:{from:o.posAtStart,to:o.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}}}]),e}(),Lt=!1;function Yr(e){Lt||(Lt=!0,getComputedStyle(e.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}function Jr(e,r,t){var n=e.docView.parseRange(r,t),o=n.node,i=n.fromOffset,s=n.toOffset,a=n.from,l=n.to,u=e.domSelection(),c,f=u.anchorNode;if(f&&e.dom.contains(f.nodeType==1?f:f.parentNode)&&(c=[{node:f,offset:u.anchorOffset}],rt(u)||c.push({node:u.focusNode,offset:u.focusOffset})),A&&e.input.lastKeyCode===8)for(var d=s;d>i;d--){var h=o.childNodes[d-1],p=h.pmViewDesc;if(h.nodeName=="BR"&&!p){s=d;break}if(!p||p.size)break}var g=e.state.doc,D=e.someProp("domParser")||O.DOMParser.fromSchema(e.state.schema),v=g.resolve(a),m=null,S=D.parse(o,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:i,to:s,preserveWhitespace:v.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:Qr,context:v});if(c&&c[0].pos!=null){var k=c[0].pos,b=c[1]&&c[1].pos;b==null&&(b=k),m={anchor:k+a,head:b+a}}return{doc:S,sel:m,from:a,to:l}}function Qr(e){var r=e.pmViewDesc;if(r)return r.parseRule();if(e.nodeName=="BR"&&e.parentNode){if(F&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){var t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(e.parentNode.lastChild==e||F&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if(e.nodeName=="IMG"&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}function Zr(e,r,t,n,o){if(r<0){var i=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,s=sn(e,i);if(s&&!e.state.selection.eq(s)){var a=e.state.tr.setSelection(s);i=="pointer"?a.setMeta("pointer",!0):i=="key"&&a.scrollIntoView(),e.dispatch(a)}return}var l=e.state.doc.resolve(r),u=l.sharedDepth(t);r=l.before(u+1),t=e.state.doc.resolve(t).after(u+1);var c=e.state.selection,f=Jr(e,r,t);if(A&&e.cursorWrapper&&f.sel&&f.sel.anchor==e.cursorWrapper.deco.from){var d=e.cursorWrapper.deco.type.toDOM.nextSibling,h=d&&d.nodeValue?d.nodeValue.length:1;f.sel={anchor:f.sel.anchor+h,head:f.sel.anchor+h}}var p=e.state.doc,g=p.slice(f.from,f.to),D,v;e.input.lastKeyCode===8&&Date.now()-100<e.input.lastKeyCodeTime?(D=e.state.selection.to,v="end"):(D=e.state.selection.from,v="start"),e.input.lastKeyCode=null;var m=wr(g.content,f.doc.content,f.from,D,v);if((be&&e.input.lastIOSEnter>Date.now()-225||U)&&o.some(function(C){return C.nodeName=="DIV"||C.nodeName=="P"})&&(!m||m.endA>=m.endB)&&e.someProp("handleKeyDown",function(C){return C(e,ge(13,"Enter"))})){e.input.lastIOSEnter=0;return}if(!m)if(n&&c instanceof y.TextSelection&&!c.empty&&c.$head.sameParent(c.$anchor)&&!e.composing&&!(f.sel&&f.sel.anchor!=f.sel.head))m={start:c.from,endA:c.to,endB:c.to};else{if(f.sel){var S=qt(e,e.state.doc,f.sel);S&&!S.eq(e.state.selection)&&e.dispatch(e.state.tr.setSelection(S))}return}e.input.domChangeCount++,e.state.selection.from<e.state.selection.to&&m.start==m.endB&&e.state.selection instanceof y.TextSelection&&(m.start>e.state.selection.from&&m.start<=e.state.selection.from+2&&e.state.selection.from>=f.from?m.start=e.state.selection.from:m.endA<e.state.selection.to&&m.endA>=e.state.selection.to-2&&e.state.selection.to<=f.to&&(m.endB+=e.state.selection.to-m.endA,m.endA=e.state.selection.to)),$&&_<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>f.from&&f.doc.textBetween(m.start-f.from-1,m.start-f.from+1)==" \xA0"&&(m.start--,m.endA--,m.endB--);var k=f.doc.resolveNoCache(m.start-f.from),b=f.doc.resolveNoCache(m.endB-f.from),N=p.resolve(m.start),B=k.sameParent(b)&&k.parent.inlineContent&&N.end()>=m.endA,K;if((be&&e.input.lastIOSEnter>Date.now()-225&&(!B||o.some(function(C){return C.nodeName=="DIV"||C.nodeName=="P"}))||!B&&k.pos<f.doc.content.size&&(K=y.Selection.findFrom(f.doc.resolve(k.pos+1),1,!0))&&K.head==b.pos)&&e.someProp("handleKeyDown",function(C){return C(e,ge(13,"Enter"))})){e.input.lastIOSEnter=0;return}if(e.state.selection.anchor>m.start&&jr(p,m.start,m.endA,k,b)&&e.someProp("handleKeyDown",function(C){return C(e,ge(8,"Backspace"))})){U&&A&&e.domObserver.suppressSelectionUpdates();return}A&&U&&m.endB==m.start&&(e.input.lastAndroidDelete=Date.now()),U&&!B&&k.start()!=b.start()&&b.parentOffset==0&&k.depth==b.depth&&f.sel&&f.sel.anchor==f.sel.head&&f.sel.head==m.endA&&(m.endB-=2,b=f.doc.resolveNoCache(m.endB-f.from),setTimeout(function(){e.someProp("handleKeyDown",function(C){return C(e,ge(13,"Enter"))})},20));var x=m.start,z=m.endA,P,re,oe;if(B){if(k.pos==b.pos)$&&_<=11&&k.parentOffset==0&&(e.domObserver.suppressSelectionUpdates(),setTimeout(function(){return te(e)},20)),P=e.state.tr.delete(x,z),re=p.resolve(m.start).marksAcross(p.resolve(m.endA));else if(m.endA==m.endB&&(oe=Xr(k.parent.content.cut(k.parentOffset,b.parentOffset),N.parent.content.cut(N.parentOffset,m.endA-N.start()))))P=e.state.tr,oe.type=="add"?P.addMark(x,z,oe.mark):P.removeMark(x,z,oe.mark);else if(k.parent.child(k.index()).isText&&k.index()==b.index()-(b.textOffset?0:1)){var Se=k.parent.textBetween(k.parentOffset,b.parentOffset);if(e.someProp("handleTextInput",function(C){return C(e,x,z,Se)}))return;P=e.state.tr.insertText(Se,x,z)}}if(P||(P=e.state.tr.replace(x,z,f.doc.slice(m.start-f.from,m.endB-f.from))),f.sel){var Q=qt(e,P.doc,f.sel);Q&&!(A&&U&&e.composing&&Q.empty&&(m.start!=m.endB||e.input.lastAndroidDelete<Date.now()-100)&&(Q.head==x||Q.head==P.mapping.map(z)-1)||$&&Q.empty&&Q.head==x)&&P.setSelection(Q)}re&&P.ensureMarks(re),e.dispatch(P.scrollIntoView())}function qt(e,r,t){return Math.max(t.anchor,t.head)>r.content.size?null:it(e,r.resolve(t.anchor),r.resolve(t.head))}function Xr(e,r){for(var t=e.firstChild.marks,n=r.firstChild.marks,o=t,i=n,s,a,l,u=0;u<n.length;u++)o=n[u].removeFromSet(o);for(var c=0;c<t.length;c++)i=t[c].removeFromSet(i);if(o.length==1&&i.length==0)a=o[0],s="add",l=function(p){return p.mark(a.addToSet(p.marks))};else if(o.length==0&&i.length==1)a=i[0],s="remove",l=function(p){return p.mark(a.removeFromSet(p.marks))};else return null;for(var f=[],d=0;d<r.childCount;d++)f.push(l(r.child(d)));if(O.Fragment.from(f).eq(e))return{mark:a,type:s}}function jr(e,r,t,n,o){if(!n.parent.isTextblock||t-r<=o.pos-n.pos||He(n,!0,!1)<o.pos)return!1;var i=e.resolve(r);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=e.resolve(He(i,!0,!0));return!s.parent.isTextblock||s.pos>t||He(s,!0,!1)<t?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function He(e,r,t){for(var n=e.depth,o=r?e.end():e.pos;n>0&&(r||e.indexAfter(n)==e.node(n).childCount);)n--,o++,r=!1;if(t)for(var i=e.node(n).maybeChild(e.indexAfter(n));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function wr(e,r,t,n,o){var i=e.findDiffStart(r,t);if(i==null)return null;var s=e.findDiffEnd(r,t+e.size,t+r.size),a=s.a,l=s.b;if(o=="end"){var u=Math.max(0,i-Math.min(a,l));n-=a+u-i}if(a<i&&e.size<r.size){var c=n<=i&&n>=a?i-n:0;i-=c,l=i+(l-a),a=i}else if(l<i){var f=n<=i&&n>=l?i-n:0;i-=f,a=i+(a-l),l=i}return{start:i,endA:a,endB:l}}var _r=st,eo=at,to=Ve,no=function(){function e(r,t){var n=this;M(this,e),this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new kr,this.prevDirectPlugins=[],this.pluginViews=[],this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Ut),this.dispatch=this.dispatch.bind(this),this.dom=r&&r.mount||document.createElement("div"),r&&(r.appendChild?r.appendChild(this.dom):typeof r=="function"?r(this.dom):r.mount&&(this.mounted=!0)),this.editable=Wt(this),Kt(this),this.nodeViews=Ht(this),this.docView=Nt(this.state.doc,$t(this),We(this),this.dom,this),this.domObserver=new Gr(this,function(o,i,s,a){return Zr(n,o,i,s,a)}),this.domObserver.start(),br(this),this.updatePluginViews()}return T(e,[{key:"composing",get:function(){return this.input.composing}},{key:"props",get:function(){if(this._props.state!=this.state){var t=this._props;this._props={};for(var n in t)this._props[n]=t[n];this._props.state=this.state}return this._props}},{key:"update",value:function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&et(this),this._props=t,t.plugins&&(t.plugins.forEach(Ut),this.directPlugins=t.plugins),this.updateStateInner(t.state,!0)}},{key:"setProps",value:function(t){var n={};for(var o in this._props)n[o]=this._props[o];n.state=this.state;for(var i in t)n[i]=t[i];this.update(n)}},{key:"updateState",value:function(t){this.updateStateInner(t,this.state.plugins!=t.plugins)}},{key:"updateStateInner",value:function(t,n){var o=this,i=this.state,s=!1,a=!1;if(t.storedMarks&&this.composing&&(kn(this),a=!0),this.state=t,n){var l=Ht(this);oo(l,this.nodeViews)&&(this.nodeViews=l,s=!0),et(this)}this.editable=Wt(this),Kt(this);var u=We(this),c=$t(this),f=n?"reset":t.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(t.doc,c,u);(d||!t.selection.eq(i.selection))&&(a=!0);var h=f=="preserve"&&a&&this.dom.style.overflowAnchor==null&&qn(this);if(a){this.domObserver.stop();var p=d&&($||A)&&!this.composing&&!i.selection.empty&&!t.selection.empty&&ro(i.selection,t.selection);if(d){var g=A?this.trackWrites=this.domSelection().focusNode:null;(s||!this.docView.update(t.doc,c,u,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Nt(t.doc,c,u,this.dom,this)),g&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelection())&&cr(this))?te(this,p):(ln(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(i),f=="reset")this.dom.scrollTop=0;else if(f=="to selection"){var D=this.domSelection().focusNode;if(!this.someProp("handleScrollToSelection",function(m){return m(o)}))if(t.selection instanceof y.NodeSelection){var v=this.docView.domAfterPos(t.selection.from);v.nodeType==1&&yt(this,v.getBoundingClientRect(),D)}else yt(this,this.coordsAtPos(t.selection.head,1),D)}else h&&$n(h)}},{key:"destroyPluginViews",value:function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()}},{key:"updatePluginViews",value:function(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var n=0;n<this.directPlugins.length;n++){var o=this.directPlugins[n];o.spec.view&&this.pluginViews.push(o.spec.view(this))}for(var i=0;i<this.state.plugins.length;i++){var s=this.state.plugins[i];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(var a=0;a<this.pluginViews.length;a++){var l=this.pluginViews[a];l.update&&l.update(this,t)}}},{key:"someProp",value:function(t,n){var o=this._props&&this._props[t],i;if(o!=null&&(i=n?n(o):o))return i;for(var s=0;s<this.directPlugins.length;s++){var a=this.directPlugins[s].props[t];if(a!=null&&(i=n?n(a):a))return i}var l=this.state.plugins;if(l)for(var u=0;u<l.length;u++){var c=l[u].props[t];if(c!=null&&(i=n?n(c):c))return i}}},{key:"hasFocus",value:function(){return this.root.activeElement==this.dom}},{key:"focus",value:function(){this.domObserver.stop(),this.editable&&Kn(this.dom),te(this),this.domObserver.start()}},{key:"root",get:function(){var t=this,n=this._root;if(n==null)for(var o=function(l){if(l.nodeType==9||l.nodeType==11&&l.host)return l.getSelection||(Object.getPrototypeOf(l).getSelection=function(){return l.ownerDocument.getSelection()}),{v:t._root=l}},i=this.dom.parentNode;i;i=i.parentNode){var s=o(i);if(ke(s)==="object")return s.v}return n||document}},{key:"posAtCoords",value:function(t){return Yn(this,t)}},{key:"coordsAtPos",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return jt(this,t,n)}},{key:"domAtPos",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.docView.domFromPos(t,n)}},{key:"nodeDOM",value:function(t){var n=this.docView.descAt(t);return n?n.nodeDOM:null}},{key:"posAtDOM",value:function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=this.docView.posFromDOM(t,n,o);if(i==null)throw new RangeError("DOM position not inside the editor");return i}},{key:"endOfTextblock",value:function(t,n){return jn(this,n||this.state,t)}},{key:"destroy",value:function(){!this.docView||(Dr(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],We(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}},{key:"isDestroyed",get:function(){return this.docView==null}},{key:"dispatchEvent",value:function(t){return Nr(this,t)}},{key:"dispatch",value:function(t){var n=this._props.dispatchTransaction;n?n.call(this,t):this.updateState(this.state.apply(t))}},{key:"domSelection",value:function(){return this.root.getSelection()}}]),e}();function $t(e){var r=Object.create(null);return r.class="ProseMirror",r.contenteditable=String(e.editable),r.translate="no",e.someProp("attributes",function(t){if(typeof t=="function"&&(t=t(e.state)),t)for(var n in t)n=="class"&&(r.class+=" "+t[n]),n=="style"?r.style=(r.style?r.style+";":"")+t[n]:!r[n]&&n!="contenteditable"&&n!="nodeName"&&(r[n]=String(t[n]))}),[he.node(0,e.state.doc.content.size,r)]}function Kt(e){if(e.markCursor){var r=document.createElement("img");r.className="ProseMirror-separator",r.setAttribute("mark-placeholder","true"),r.setAttribute("alt",""),e.cursorWrapper={dom:r,deco:he.widget(e.state.selection.head,r,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function Wt(e){return!e.someProp("editable",function(r){return r(e.state)===!1})}function ro(e,r){var t=Math.min(e.$anchor.sharedDepth(e.head),r.$anchor.sharedDepth(r.head));return e.$anchor.start(t)!=r.$anchor.start(t)}function Ht(e){var r=Object.create(null);function t(n){for(var o in n)Object.prototype.hasOwnProperty.call(r,o)||(r[o]=n[o])}return e.someProp("nodeViews",t),e.someProp("markViews",t),r}function oo(e,r){var t=0,n=0;for(var o in e){if(e[o]!=r[o])return!0;t++}for(var i in r)n++;return t!=n}function Ut(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var lo=ce.Decoration=he,uo=ce.DecorationSet=X,co=ce.EditorView=no;ce.__endComposition=to;ce.__parseFromClipboard=eo;ce.__serializeForClipboard=_r;export{uo as D,co as E,lo as a,ce as d};
