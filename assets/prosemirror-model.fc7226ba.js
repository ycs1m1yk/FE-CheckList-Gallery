import{d as Te}from"./orderedmap.6572a778.js";var k={};function D(){return typeof Reflect!="undefined"&&Reflect.get?D=Reflect.get:D=function(n,e,t){var r=be(n,e);if(!!r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?n:t):i.value}},D.apply(this,arguments)}function be(a,n){for(;!Object.prototype.hasOwnProperty.call(a,n)&&(a=T(a),a!==null););return a}function ae(a,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(n&&n.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),n&&z(a,n)}function se(a){var n=oe();return function(){var t=T(a),r;if(n){var i=T(this).constructor;r=Reflect.construct(t,arguments,i)}else r=t.apply(this,arguments);return Ne(this,r)}}function Ne(a,n){if(n&&(w(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ce(a)}function Ce(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function H(a){var n=typeof Map=="function"?new Map:void 0;return H=function(t){if(t===null||!Re(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(t))return n.get(t);n.set(t,r)}function r(){return J(t,arguments,T(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),z(r,t)},H(a)}function J(a,n,e){return oe()?J=Reflect.construct:J=function(r,i,s){var o=[null];o.push.apply(o,i);var u=Function.bind.apply(r,o),f=new u;return s&&z(f,s.prototype),f},J.apply(null,arguments)}function oe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Re(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function z(a,n){return z=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t},z(a,n)}function T(a){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},T(a)}function g(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function X(a,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}}function y(a,n,e){return n&&X(a.prototype,n),e&&X(a,e),Object.defineProperty(a,"prototype",{writable:!1}),a}function w(a){return w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},w(a)}Object.defineProperty(k,"__esModule",{value:!0});var ze=Te;function Ie(a){return a&&w(a)==="object"&&"default"in a?a:{default:a}}var Y=Ie(ze);function ue(a,n,e){for(var t=0;;t++){if(t==a.childCount||t==n.childCount)return a.childCount==n.childCount?null:e;var r=a.child(t),i=n.child(t);if(r==i){e+=r.nodeSize;continue}if(!r.sameMarkup(i))return e;if(r.isText&&r.text!=i.text){for(var s=0;r.text[s]==i.text[s];s++)e++;return e}if(r.content.size||i.content.size){var o=ue(r.content,i.content,e+1);if(o!=null)return o}e+=r.nodeSize}}function fe(a,n,e,t){for(var r=a.childCount,i=n.childCount;;){if(r==0||i==0)return r==i?null:{a:e,b:t};var s=a.child(--r),o=n.child(--i),u=s.nodeSize;if(s==o){e-=u,t-=u;continue}if(!s.sameMarkup(o))return{a:e,b:t};if(s.isText&&s.text!=o.text){for(var f=0,l=Math.min(s.text.length,o.text.length);f<l&&s.text[s.text.length-f-1]==o.text[o.text.length-f-1];)f++,e--,t--;return{a:e,b:t}}if(s.content.size||o.content.size){var h=fe(s.content,o.content,e-1,t-1);if(h)return h}e-=u,t-=u}}var p=function(){function a(n,e){if(g(this,a),this.content=n,this.size=e||0,e==null)for(var t=0;t<n.length;t++)this.size+=n[t].nodeSize}return y(a,[{key:"nodesBetween",value:function(e,t,r){for(var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,o=0,u=0;u<t;o++){var f=this.content[o],l=u+f.nodeSize;if(l>e&&r(f,i+u,s||null,o)!==!1&&f.content.size){var h=u+1;f.nodesBetween(Math.max(0,e-h),Math.min(f.content.size,t-h),r,i+h)}u=l}}},{key:"descendants",value:function(e){this.nodesBetween(0,this.size,e)}},{key:"textBetween",value:function(e,t,r,i){var s="",o=!0;return this.nodesBetween(e,t,function(u,f){u.isText?(s+=u.text.slice(Math.max(e,f)-f,t-f),o=!r):u.isLeaf?(i?s+=typeof i=="function"?i(u):i:u.type.spec.leafText&&(s+=u.type.spec.leafText(u)),o=!r):!o&&u.isBlock&&(s+=r,o=!0)},0),s}},{key:"append",value:function(e){if(!e.size)return this;if(!this.size)return e;var t=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(r)&&(i[i.length-1]=t.withText(t.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new a(i,this.size+e.size)}},{key:"cut",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.size;if(e==0&&t==this.size)return this;var r=[],i=0;if(t>e)for(var s=0,o=0;o<t;s++){var u=this.content[s],f=o+u.nodeSize;f>e&&((o<e||f>t)&&(u.isText?u=u.cut(Math.max(0,e-o),Math.min(u.text.length,t-o)):u=u.cut(Math.max(0,e-o-1),Math.min(u.content.size,t-o-1))),r.push(u),i+=u.nodeSize),o=f}return new a(r,i)}},{key:"cutByIndex",value:function(e,t){return e==t?a.empty:e==0&&t==this.content.length?this:new a(this.content.slice(e,t))}},{key:"replaceChild",value:function(e,t){var r=this.content[e];if(r==t)return this;var i=this.content.slice(),s=this.size+t.nodeSize-r.nodeSize;return i[e]=t,new a(i,s)}},{key:"addToStart",value:function(e){return new a([e].concat(this.content),this.size+e.nodeSize)}},{key:"addToEnd",value:function(e){return new a(this.content.concat(e),this.size+e.nodeSize)}},{key:"eq",value:function(e){if(this.content.length!=e.content.length)return!1;for(var t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}},{key:"firstChild",get:function(){return this.content.length?this.content[0]:null}},{key:"lastChild",get:function(){return this.content.length?this.content[this.content.length-1]:null}},{key:"childCount",get:function(){return this.content.length}},{key:"child",value:function(e){var t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}},{key:"maybeChild",value:function(e){return this.content[e]||null}},{key:"forEach",value:function(e){for(var t=0,r=0;t<this.content.length;t++){var i=this.content[t];e(i,r,t),r+=i.nodeSize}}},{key:"findDiffStart",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return ue(this,e,t)}},{key:"findDiffEnd",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.size,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.size;return fe(this,e,t,r)}},{key:"findIndex",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1;if(e==0)return P(0,e);if(e==this.size)return P(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position ".concat(e," outside of fragment (").concat(this,")"));for(var r=0,i=0;;r++){var s=this.child(r),o=i+s.nodeSize;if(o>=e)return o==e||t>0?P(r+1,o):P(r,i);i=o}}},{key:"toString",value:function(){return"<"+this.toStringInner()+">"}},{key:"toStringInner",value:function(){return this.content.join(", ")}},{key:"toJSON",value:function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null}}],[{key:"fromJSON",value:function(e,t){if(!t)return a.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new a(t.map(e.nodeFromJSON))}},{key:"fromArray",value:function(e){if(!e.length)return a.empty;for(var t,r=0,i=0;i<e.length;i++){var s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new a(t||e,r)}},{key:"from",value:function(e){if(!e)return a.empty;if(e instanceof a)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new a([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}]),a}();p.empty=new p([],0);var W={index:0,offset:0};function P(a,n){return W.index=a,W.offset=n,W}function _(a,n){if(a===n)return!0;if(!(a&&w(a)=="object")||!(n&&w(n)=="object"))return!1;var e=Array.isArray(a);if(Array.isArray(n)!=e)return!1;if(e){if(a.length!=n.length)return!1;for(var t=0;t<a.length;t++)if(!_(a[t],n[t]))return!1}else{for(var r in a)if(!(r in n)||!_(a[r],n[r]))return!1;for(var i in n)if(!(i in a))return!1}return!0}var v=function(){function a(n,e){g(this,a),this.type=n,this.attrs=e}return y(a,[{key:"addToSet",value:function(e){for(var t,r=!1,i=0;i<e.length;i++){var s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),r=!0),t&&t.push(s)}}return t||(t=e.slice()),r||t.push(this),t}},{key:"removeFromSet",value:function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}},{key:"isInSet",value:function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}},{key:"eq",value:function(e){return this==e||this.type==e.type&&_(this.attrs,e.attrs)}},{key:"toJSON",value:function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return e}}],[{key:"fromJSON",value:function(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");var r=e.marks[t.type];if(!r)throw new RangeError("There is no mark type ".concat(t.type," in this schema"));return r.create(t.attrs)}},{key:"sameSet",value:function(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}},{key:"setFrom",value:function(e){if(!e||Array.isArray(e)&&e.length==0)return a.none;if(e instanceof a)return[e];var t=e.slice();return t.sort(function(r,i){return r.type.rank-i.type.rank}),t}}]),a}();v.none=[];var I=function(a){ae(e,a);var n=se(e);function e(){return g(this,e),n.apply(this,arguments)}return y(e)}(H(Error)),b=function(){function a(n,e,t){g(this,a),this.content=n,this.openStart=e,this.openEnd=t}return y(a,[{key:"size",get:function(){return this.content.size-this.openStart-this.openEnd}},{key:"insertAt",value:function(e,t){var r=le(this.content,e+this.openStart,t);return r&&new a(r,this.openStart,this.openEnd)}},{key:"removeBetween",value:function(e,t){return new a(he(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}},{key:"eq",value:function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}},{key:"toString",value:function(){return this.content+"("+this.openStart+","+this.openEnd+")"}},{key:"toJSON",value:function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}}],[{key:"fromJSON",value:function(e,t){if(!t)return a.empty;var r=t.openStart||0,i=t.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new a(p.fromJSON(e,t.content),r,i)}},{key:"maxOpen",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=0,i=0,s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)r++;for(var o=e.lastChild;o&&!o.isLeaf&&(t||!o.type.spec.isolating);o=o.lastChild)i++;return new a(e,r,i)}}]),a}();b.empty=new b(p.empty,0,0);function he(a,n,e){var t=a.findIndex(n),r=t.index,i=t.offset,s=a.maybeChild(r),o=a.findIndex(e),u=o.index,f=o.offset;if(i==n||s.isText){if(f!=e&&!a.child(u).isText)throw new RangeError("Removing non-flat range");return a.cut(0,n).append(a.cut(e))}if(r!=u)throw new RangeError("Removing non-flat range");return a.replaceChild(r,s.copy(he(s.content,n-i-1,e-i-1)))}function le(a,n,e,t){var r=a.findIndex(n),i=r.index,s=r.offset,o=a.maybeChild(i);if(s==n||o.isText)return t&&!t.canReplace(i,i,e)?null:a.cut(0,n).append(e).append(a.cut(n));var u=le(o.content,n-s-1,e);return u&&a.replaceChild(i,o.copy(u))}function Fe(a,n,e){if(e.openStart>a.depth)throw new I("Inserted content deeper than insertion position");if(a.depth-e.openStart!=n.depth-e.openEnd)throw new I("Inconsistent open depths");return ce(a,n,e,0)}function ce(a,n,e,t){var r=a.index(t),i=a.node(t);if(r==n.index(t)&&t<a.depth-e.openStart){var s=ce(a,n,e,t+1);return i.copy(i.content.replaceChild(r,s))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&a.depth==t&&n.depth==t){var o=a.parent,u=o.content;return M(o,u.cut(0,a.parentOffset).append(e.content).append(u.cut(n.parentOffset)))}else{var f=Pe(e,a),l=f.start,h=f.end;return M(i,ve(a,l,h,n,t))}else return M(i,q(a,n,t))}function de(a,n){if(!n.type.compatibleContent(a.type))throw new I("Cannot join "+n.type.name+" onto "+a.type.name)}function G(a,n,e){var t=a.node(e);return de(t,n.node(e)),t}function O(a,n){var e=n.length-1;e>=0&&a.isText&&a.sameMarkup(n[e])?n[e]=a.withText(n[e].text+a.text):n.push(a)}function C(a,n,e,t){var r=(n||a).node(e),i=0,s=n?n.index(e):r.childCount;a&&(i=a.index(e),a.depth>e?i++:a.textOffset&&(O(a.nodeAfter,t),i++));for(var o=i;o<s;o++)O(r.child(o),t);n&&n.depth==e&&n.textOffset&&O(n.nodeBefore,t)}function M(a,n){if(!a.type.validContent(n))throw new I("Invalid content for node "+a.type.name);return a.copy(n)}function ve(a,n,e,t,r){var i=a.depth>r&&G(a,n,r+1),s=t.depth>r&&G(e,t,r+1),o=[];return C(null,a,r,o),i&&s&&n.index(r)==e.index(r)?(de(i,s),O(M(i,ve(a,n,e,t,r+1)),o)):(i&&O(M(i,q(a,n,r+1)),o),C(n,e,r,o),s&&O(M(s,q(e,t,r+1)),o)),C(t,null,r,o),new p(o)}function q(a,n,e){var t=[];if(C(null,a,e,t),a.depth>e){var r=G(a,n,e+1);O(M(r,q(a,n,e+1)),t)}return C(n,null,e,t),new p(t)}function Pe(a,n){for(var e=n.depth-a.openStart,t=n.node(e),r=t.copy(a.content),i=e-1;i>=0;i--)r=n.node(i).copy(p.from(r));return{start:r.resolveNoCache(a.openStart+e),end:r.resolveNoCache(r.content.size-a.openEnd-e)}}var K=function(){function a(n,e,t){g(this,a),this.pos=n,this.path=e,this.parentOffset=t,this.depth=e.length/3-1}return y(a,[{key:"resolveDepth",value:function(e){return e==null?this.depth:e<0?this.depth+e:e}},{key:"parent",get:function(){return this.node(this.depth)}},{key:"doc",get:function(){return this.node(0)}},{key:"node",value:function(e){return this.path[this.resolveDepth(e)*3]}},{key:"index",value:function(e){return this.path[this.resolveDepth(e)*3+1]}},{key:"indexAfter",value:function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}},{key:"start",value:function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}},{key:"end",value:function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}},{key:"before",value:function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}},{key:"after",value:function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}},{key:"textOffset",get:function(){return this.pos-this.path[this.path.length-1]}},{key:"nodeAfter",get:function(){var e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;var r=this.pos-this.path[this.path.length-1],i=e.child(t);return r?e.child(t).cut(r):i}},{key:"nodeBefore",get:function(){var e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}},{key:"posAtIndex",value:function(e,t){t=this.resolveDepth(t);for(var r=this.path[t*3],i=t==0?0:this.path[t*3-1]+1,s=0;s<e;s++)i+=r.child(s).nodeSize;return i}},{key:"marks",value:function(){var e=this.parent,t=this.index();if(e.content.size==0)return v.none;if(this.textOffset)return e.child(t).marks;var r=e.maybeChild(t-1),i=e.maybeChild(t);if(!r){var s=r;r=i,i=s}for(var o=r.marks,u=0;u<o.length;u++)o[u].type.spec.inclusive===!1&&(!i||!o[u].isInSet(i.marks))&&(o=o[u--].removeFromSet(o));return o}},{key:"marksAcross",value:function(e){var t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;for(var r=t.marks,i=e.parent.maybeChild(e.index()),s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}},{key:"sharedDepth",value:function(e){for(var t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}},{key:"blockRange",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this,t=arguments.length>1?arguments[1]:void 0;if(e.pos<this.pos)return e.blockRange(this);for(var r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new pe(this,e,r);return null}},{key:"sameParent",value:function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}},{key:"max",value:function(e){return e.pos>this.pos?e:this}},{key:"min",value:function(e){return e.pos<this.pos?e:this}},{key:"toString",value:function(){for(var e="",t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}}],[{key:"resolve",value:function(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");for(var r=[],i=0,s=t,o=e;;){var u=o.content.findIndex(s),f=u.index,l=u.offset,h=s-l;if(r.push(o,f,i+l),!h||(o=o.child(f),o.isText))break;s=h-1,i+=l+1}return new a(t,r,s)}},{key:"resolveCached",value:function(e,t){for(var r=0;r<U.length;r++){var i=U[r];if(i.pos==t&&i.doc==e)return i}var s=U[j]=a.resolve(e,t);return j=(j+1)%Ae,s}}]),a}(),U=[],j=0,Ae=12,pe=function(){function a(n,e,t){g(this,a),this.$from=n,this.$to=e,this.depth=t}return y(a,[{key:"start",get:function(){return this.$from.before(this.depth+1)}},{key:"end",get:function(){return this.$to.after(this.depth+1)}},{key:"parent",get:function(){return this.$from.node(this.depth)}},{key:"startIndex",get:function(){return this.$from.index(this.depth)}},{key:"endIndex",get:function(){return this.$to.indexAfter(this.depth)}}]),a}(),De=Object.create(null),E=function(){function a(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:v.none;g(this,a),this.type=n,this.attrs=e,this.marks=r,this.content=t||p.empty}return y(a,[{key:"nodeSize",get:function(){return this.isLeaf?1:2+this.content.size}},{key:"childCount",get:function(){return this.content.childCount}},{key:"child",value:function(e){return this.content.child(e)}},{key:"maybeChild",value:function(e){return this.content.maybeChild(e)}},{key:"forEach",value:function(e){this.content.forEach(e)}},{key:"nodesBetween",value:function(e,t,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;this.content.nodesBetween(e,t,r,i,this)}},{key:"descendants",value:function(e){this.nodesBetween(0,this.content.size,e)}},{key:"textContent",get:function(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}},{key:"textBetween",value:function(e,t,r,i){return this.content.textBetween(e,t,r,i)}},{key:"firstChild",get:function(){return this.content.firstChild}},{key:"lastChild",get:function(){return this.content.lastChild}},{key:"eq",value:function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}},{key:"sameMarkup",value:function(e){return this.hasMarkup(e.type,e.attrs,e.marks)}},{key:"hasMarkup",value:function(e,t,r){return this.type==e&&_(this.attrs,t||e.defaultAttrs||De)&&v.sameSet(this.marks,r||v.none)}},{key:"copy",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return e==this.content?this:new a(this.type,this.attrs,e,this.marks)}},{key:"mark",value:function(e){return e==this.marks?this:new a(this.type,this.attrs,this.content,e)}},{key:"cut",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.content.size;return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}},{key:"slice",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.content.size,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e==t)return b.empty;var i=this.resolve(e),s=this.resolve(t),o=r?0:i.sharedDepth(t),u=i.start(o),f=i.node(o),l=f.content.cut(i.pos-u,s.pos-u);return new b(l,i.depth-o,s.depth-o)}},{key:"replace",value:function(e,t,r){return Fe(this.resolve(e),this.resolve(t),r)}},{key:"nodeAt",value:function(e){for(var t=this;;){var r=t.content.findIndex(e),i=r.index,s=r.offset;if(t=t.maybeChild(i),!t)return null;if(s==e||t.isText)return t;e-=s+1}}},{key:"childAfter",value:function(e){var t=this.content.findIndex(e),r=t.index,i=t.offset;return{node:this.content.maybeChild(r),index:r,offset:i}}},{key:"childBefore",value:function(e){if(e==0)return{node:null,index:0,offset:0};var t=this.content.findIndex(e),r=t.index,i=t.offset;if(i<e)return{node:this.content.child(r),index:r,offset:i};var s=this.content.child(r-1);return{node:s,index:r-1,offset:i-s.nodeSize}}},{key:"resolve",value:function(e){return K.resolveCached(this,e)}},{key:"resolveNoCache",value:function(e){return K.resolve(this,e)}},{key:"rangeHasMark",value:function(e,t,r){var i=!1;return t>e&&this.nodesBetween(e,t,function(s){return r.isInSet(s.marks)&&(i=!0),!i}),i}},{key:"isBlock",get:function(){return this.type.isBlock}},{key:"isTextblock",get:function(){return this.type.isTextblock}},{key:"inlineContent",get:function(){return this.type.inlineContent}},{key:"isInline",get:function(){return this.type.isInline}},{key:"isText",get:function(){return this.type.isText}},{key:"isLeaf",get:function(){return this.type.isLeaf}},{key:"isAtom",get:function(){return this.type.isAtom}},{key:"toString",value:function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),ge(this.marks,e)}},{key:"contentMatchAt",value:function(e){var t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}},{key:"canReplace",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:p.empty,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:r.childCount,o=this.contentMatchAt(e).matchFragment(r,i,s),u=o&&o.matchFragment(this.content,t);if(!u||!u.validEnd)return!1;for(var f=i;f<s;f++)if(!this.type.allowsMarks(r.child(f).marks))return!1;return!0}},{key:"canReplaceWith",value:function(e,t,r,i){if(i&&!this.type.allowsMarks(i))return!1;var s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}},{key:"canAppend",value:function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}},{key:"check",value:function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node ".concat(this.type.name,": ").concat(this.content.toString().slice(0,50)));for(var e=v.none,t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!v.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node ".concat(this.type.name,": ").concat(this.marks.map(function(r){return r.type.name})));this.content.forEach(function(r){return r.check()})}},{key:"toJSON",value:function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(r){return r.toJSON()})),e}}],[{key:"fromJSON",value:function(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");var r=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}var i=p.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,r)}}]),a}();E.prototype.text=void 0;var Je=function(a){ae(e,a);var n=se(e);function e(t,r,i,s){var o;if(g(this,e),o=n.call(this,t,r,null,s),!i)throw new RangeError("Empty text nodes are not allowed");return o.text=i,o}return y(e,[{key:"toString",value:function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ge(this.marks,JSON.stringify(this.text))}},{key:"textContent",get:function(){return this.text}},{key:"textBetween",value:function(r,i){return this.text.slice(r,i)}},{key:"nodeSize",get:function(){return this.text.length}},{key:"mark",value:function(r){return r==this.marks?this:new e(this.type,this.attrs,this.text,r)}},{key:"withText",value:function(r){return r==this.text?this:new e(this.type,this.attrs,r,this.marks)}},{key:"cut",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.text.length;return r==0&&i==this.text.length?this:this.withText(this.text.slice(r,i))}},{key:"eq",value:function(r){return this.sameMarkup(r)&&this.text==r.text}},{key:"toJSON",value:function(){var r=D(T(e.prototype),"toJSON",this).call(this);return r.text=this.text,r}}]),e}(E);function ge(a,n){for(var e=a.length-1;e>=0;e--)n=a[e].type.name+"("+n+")";return n}var N=function(){function a(n){g(this,a),this.validEnd=n,this.next=[],this.wrapCache=[]}return y(a,[{key:"matchType",value:function(e){for(var t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}},{key:"matchFragment",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.childCount,i=this,s=t;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}},{key:"inlineContent",get:function(){return this.next.length&&this.next[0].type.isInline}},{key:"defaultType",get:function(){for(var e=0;e<this.next.length;e++){var t=this.next[e].type;if(!(t.isText||t.hasRequiredAttrs()))return t}return null}},{key:"compatible",value:function(e){for(var t=0;t<this.next.length;t++)for(var r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}},{key:"fillBefore",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[this];function s(o,u){var f=o.matchFragment(e,r);if(f&&(!t||f.validEnd))return p.from(u.map(function(x){return x.createAndFill()}));for(var l=0;l<o.next.length;l++){var h=o.next[l],c=h.type,d=h.next;if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);var m=s(d,u.concat(c));if(m)return m}}return null}return s(this,[])}},{key:"findWrapping",value:function(e){for(var t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];var r=this.computeWrapping(e);return this.wrapCache.push(e,r),r}},{key:"computeWrapping",value:function(e){for(var t=Object.create(null),r=[{match:this,type:null,via:null}];r.length;){var i=r.shift(),s=i.match;if(s.matchType(e)){for(var o=[],u=i;u.type;u=u.via)o.push(u.type);return o.reverse()}for(var f=0;f<s.next.length;f++){var l=s.next[f],h=l.type,c=l.next;!h.isLeaf&&!h.hasRequiredAttrs()&&!(h.name in t)&&(!i.type||c.validEnd)&&(r.push({match:h.contentMatch,type:h,via:i}),t[h.name]=!0)}}return null}},{key:"edgeCount",get:function(){return this.next.length}},{key:"edge",value:function(e){if(e>=this.next.length)throw new RangeError("There's no ".concat(e,"th edge in this content match"));return this.next[e]}},{key:"toString",value:function(){var e=[];function t(r){e.push(r);for(var i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&t(r.next[i].next)}return t(this),e.map(function(r,i){for(var s=i+(r.validEnd?"*":" ")+" ",o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}],[{key:"parse",value:function(e,t){var r=new _e(e,t);if(r.next==null)return a.empty;var i=ye(r);r.next&&r.err("Unexpected trailing text");var s=Ve(je(i));return He(s,r),s}}]),a}();N.empty=new N(!0);var _e=function(){function a(n,e){g(this,a),this.string=n,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=n.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}return y(a,[{key:"next",get:function(){return this.tokens[this.pos]}},{key:"eat",value:function(e){return this.next==e&&(this.pos++||!0)}},{key:"err",value:function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}]),a}();function ye(a){var n=[];do n.push(qe(a));while(a.eat("|"));return n.length==1?n[0]:{type:"choice",exprs:n}}function qe(a){var n=[];do n.push(Be(a));while(a.next&&a.next!=")"&&a.next!="|");return n.length==1?n[0]:{type:"seq",exprs:n}}function Be(a){for(var n=Ue(a);;)if(a.eat("+"))n={type:"plus",expr:n};else if(a.eat("*"))n={type:"star",expr:n};else if(a.eat("?"))n={type:"opt",expr:n};else if(a.eat("{"))n=Le(a,n);else break;return n}function Z(a){/\D/.test(a.next)&&a.err("Expected number, got '"+a.next+"'");var n=Number(a.next);return a.pos++,n}function Le(a,n){var e=Z(a),t=e;return a.eat(",")&&(a.next!="}"?t=Z(a):t=-1),a.eat("}")||a.err("Unclosed braced range"),{type:"range",min:e,max:t,expr:n}}function We(a,n){var e=a.nodeTypes,t=e[n];if(t)return[t];var r=[];for(var i in e){var s=e[i];s.groups.indexOf(n)>-1&&r.push(s)}return r.length==0&&a.err("No node type or group '"+n+"' found"),r}function Ue(a){if(a.eat("(")){var n=ye(a);return a.eat(")")||a.err("Missing closing paren"),n}else if(/\W/.test(a.next))a.err("Unexpected token '"+a.next+"'");else{var e=We(a,a.next).map(function(t){return a.inline==null?a.inline=t.isInline:a.inline!=t.isInline&&a.err("Mixing inline and block content"),{type:"name",value:t}});return a.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function je(a){var n=[[]];return r(i(a,0),e()),n;function e(){return n.push([])-1}function t(s,o,u){var f={term:u,to:o};return n[s].push(f),f}function r(s,o){s.forEach(function(u){return u.to=o})}function i(s,o){if(s.type=="choice")return s.exprs.reduce(function(F,Ee){return F.concat(i(Ee,o))},[]);if(s.type=="seq")for(var u=0;;u++){var f=i(s.exprs[u],o);if(u==s.exprs.length-1)return f;r(f,o=e())}else if(s.type=="star"){var l=e();return t(o,l),r(i(s.expr,l),l),[t(l)]}else if(s.type=="plus"){var h=e();return r(i(s.expr,o),h),r(i(s.expr,h),h),[t(h)]}else{if(s.type=="opt")return[t(o)].concat(i(s.expr,o));if(s.type=="range"){for(var c=o,d=0;d<s.min;d++){var m=e();r(i(s.expr,c),m),c=m}if(s.max==-1)r(i(s.expr,c),c);else for(var x=s.min;x<s.max;x++){var S=e();t(c,S),r(i(s.expr,c),S),c=S}return[t(c)]}else{if(s.type=="name")return[t(o,void 0,s.value)];throw new Error("Unknown expr type")}}}}function me(a,n){return n-a}function $(a,n){var e=[];return t(n),e.sort(me);function t(r){var i=a[r];if(i.length==1&&!i[0].term)return t(i[0].to);e.push(r);for(var s=0;s<i.length;s++){var o=i[s],u=o.term,f=o.to;!u&&e.indexOf(f)==-1&&t(f)}}}function Ve(a){var n=Object.create(null);return e($(a,0));function e(t){var r=[];t.forEach(function(u){a[u].forEach(function(f){var l=f.term,h=f.to;if(!!l){for(var c,d=0;d<r.length;d++)r[d][0]==l&&(c=r[d][1]);$(a,h).forEach(function(m){c||r.push([l,c=[]]),c.indexOf(m)==-1&&c.push(m)})}})});for(var i=n[t.join(",")]=new N(t.indexOf(a.length-1)>-1),s=0;s<r.length;s++){var o=r[s][1].sort(me);i.next.push({type:r[s][0],next:n[o.join(",")]||e(o)})}return i}}function He(a,n){for(var e=0,t=[a];e<t.length;e++){for(var r=t[e],i=!r.validEnd,s=[],o=0;o<r.next.length;o++){var u=r.next[o],f=u.type,l=u.next;s.push(f.name),i&&!(f.isText||f.hasRequiredAttrs())&&(i=!1),t.indexOf(l)==-1&&t.push(l)}i&&n.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function ke(a){var n=Object.create(null);for(var e in a){var t=a[e];if(!t.hasDefault)return null;n[e]=t.default}return n}function xe(a,n){var e=Object.create(null);for(var t in a){var r=n&&n[t];if(r===void 0){var i=a[t];if(i.hasDefault)r=i.default;else throw new RangeError("No value supplied for attribute "+t)}e[t]=r}return e}function Se(a){var n=Object.create(null);if(a)for(var e in a)n[e]=new Ge(a[e]);return n}var Q=function(){function a(n,e,t){g(this,a),this.name=n,this.schema=e,this.spec=t,this.markSet=null,this.groups=t.group?t.group.split(" "):[],this.attrs=Se(t.attrs),this.defaultAttrs=ke(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(t.inline||n=="text"),this.isText=n=="text"}return y(a,[{key:"isInline",get:function(){return!this.isBlock}},{key:"isTextblock",get:function(){return this.isBlock&&this.inlineContent}},{key:"isLeaf",get:function(){return this.contentMatch==N.empty}},{key:"isAtom",get:function(){return this.isLeaf||!!this.spec.atom}},{key:"whitespace",get:function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}},{key:"hasRequiredAttrs",value:function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}},{key:"compatibleContent",value:function(e){return this==e||this.contentMatch.compatible(e.contentMatch)}},{key:"computeAttrs",value:function(e){return!e&&this.defaultAttrs?this.defaultAttrs:xe(this.attrs,e)}},{key:"create",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new E(this,this.computeAttrs(e),p.from(t),v.setFrom(r))}},{key:"createChecked",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(t=p.from(t),!this.validContent(t))throw new RangeError("Invalid content for node "+this.name);return new E(this,this.computeAttrs(e),t,v.setFrom(r))}},{key:"createAndFill",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(e=this.computeAttrs(e),t=p.from(t),t.size){var i=this.contentMatch.fillBefore(t);if(!i)return null;t=i.append(t)}var s=this.contentMatch.matchFragment(t),o=s&&s.fillBefore(p.empty,!0);return o?new E(this,e,t.append(o),v.setFrom(r)):null}},{key:"validContent",value:function(e){var t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(var r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}},{key:"allowsMarkType",value:function(e){return this.markSet==null||this.markSet.indexOf(e)>-1}},{key:"allowsMarks",value:function(e){if(this.markSet==null)return!0;for(var t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}},{key:"allowedMarks",value:function(e){if(this.markSet==null)return e;for(var t,r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:v.none:e}}],[{key:"compile",value:function(e,t){var r=Object.create(null);e.forEach(function(o,u){return r[o]=new a(o,t,u)});var i=t.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}}]),a}(),Ge=function(){function a(n){g(this,a),this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default}return y(a,[{key:"isRequired",get:function(){return!this.hasDefault}}]),a}(),we=function(){function a(n,e,t,r){g(this,a),this.name=n,this.rank=e,this.schema=t,this.spec=r,this.attrs=Se(r.attrs),this.excluded=null;var i=ke(this.attrs);this.instance=i?new v(this,i):null}return y(a,[{key:"create",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return!e&&this.instance?this.instance:new v(this,xe(this.attrs,e))}},{key:"removeFromSet",value:function(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}},{key:"isInSet",value:function(e){for(var t=0;t<e.length;t++)if(e[t].type==this)return e[t]}},{key:"excludes",value:function(e){return this.excluded.indexOf(e)>-1}}],[{key:"compile",value:function(e,t){var r=Object.create(null),i=0;return e.forEach(function(s,o){return r[s]=new a(s,i++,t,o)}),r}}]),a}(),Ke=function(){function a(n){g(this,a),this.cached=Object.create(null),this.spec={nodes:Y.default.from(n.nodes),marks:Y.default.from(n.marks||{}),topNode:n.topNode},this.nodes=Q.compile(this.spec.nodes,this),this.marks=we.compile(this.spec.marks,this);var e=Object.create(null);for(var t in this.nodes){if(t in this.marks)throw new RangeError(t+" can not be both a node and a mark");var r=this.nodes[t],i=r.spec.content||"",s=r.spec.marks;r.contentMatch=e[i]||(e[i]=N.parse(i,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.markSet=s=="_"?null:s?ee(this,s.split(" ")):s==""||!r.inlineContent?[]:null}for(var o in this.marks){var u=this.marks[o],f=u.spec.excludes;u.excluded=f==null?[u]:f==""?[]:ee(this,f.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}return y(a,[{key:"node",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Q){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,r,i)}},{key:"text",value:function(e,t){var r=this.nodes.text;return new Je(r,r.defaultAttrs,e,v.setFrom(t))}},{key:"mark",value:function(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}},{key:"nodeFromJSON",value:function(e){return E.fromJSON(this,e)}},{key:"markFromJSON",value:function(e){return v.fromJSON(this,e)}},{key:"nodeType",value:function(e){var t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}]),a}();function ee(a,n){for(var e=[],t=0;t<n.length;t++){var r=n[t],i=a.marks[r],s=i;if(i)e.push(i);else for(var o in a.marks){var u=a.marks[o];(r=="_"||u.spec.group&&u.spec.group.split(" ").indexOf(r)>-1)&&e.push(s=u)}if(!s)throw new SyntaxError("Unknown mark type: '"+n[t]+"'")}return e}var Qe=function(){function a(n,e){var t=this;g(this,a),this.schema=n,this.rules=e,this.tags=[],this.styles=[],e.forEach(function(r){r.tag?t.tags.push(r):r.style&&t.styles.push(r)}),this.normalizeLists=!this.tags.some(function(r){if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;var i=n.nodes[r.node];return i.contentMatch.matchType(i)})}return y(a,[{key:"parse",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new ne(this,t,!1);return r.addAll(e,t.from,t.to),r.finish()}},{key:"parseSlice",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new ne(this,t,!0);return r.addAll(e,t.from,t.to),b.maxOpen(r.finish())}},{key:"matchTag",value:function(e,t,r){for(var i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){var s=this.tags[i];if(Ze(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){var o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}},{key:"matchStyle",value:function(e,t,r,i){for(var s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){var o=this.styles[s],u=o.style;if(!(u.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||u.length>e.length&&(u.charCodeAt(e.length)!=61||u.slice(e.length+1)!=t))){if(o.getAttrs){var f=o.getAttrs(t);if(f===!1)continue;o.attrs=f||void 0}return o}}}}],[{key:"schemaRules",value:function(e){var t=[];function r(f){for(var l=f.priority==null?50:f.priority,h=0;h<t.length;h++){var c=t[h],d=c.priority==null?50:c.priority;if(d<l)break}t.splice(h,0,f)}var i=function(l){var h=e.marks[l].spec.parseDOM;h&&h.forEach(function(c){r(c=re(c)),c.mark=l})};for(var s in e.marks)i(s);var o=function(l){var h=e.nodes[l].spec.parseDOM;h&&h.forEach(function(c){r(c=re(c)),c.node=l})};for(var u in e.nodes)o(u);return t}},{key:"fromSchema",value:function(e){return e.cached.domParser||(e.cached.domParser=new a(e,a.schemaRules(e)))}}]),a}(),Oe={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Xe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Me={ol:!0,ul:!0},B=1,L=2,R=4;function te(a,n,e){return n!=null?(n?B:0)|(n==="full"?L:0):a&&a.whitespace=="pre"?B|L:e&~R}var A=function(){function a(n,e,t,r,i,s,o){g(this,a),this.type=n,this.attrs=e,this.marks=t,this.pendingMarks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=v.none,this.stashMarks=[],this.match=s||(o&R?null:n.contentMatch)}return y(a,[{key:"findWrapping",value:function(e){if(!this.match){if(!this.type)return[];var t=this.type.contentMatch.fillBefore(p.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{var r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}},{key:"finish",value:function(e){if(!(this.options&B)){var t=this.content[this.content.length-1],r;if(t&&t.isText&&(r=/[ \t\r\n\u000c]+$/.exec(t.text))){var i=t;t.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-r[0].length))}}var s=p.from(this.content);return!e&&this.match&&(s=s.append(this.match.fillBefore(p.empty,!0))),this.type?this.type.create(this.attrs,s,this.marks):s}},{key:"popFromStashMark",value:function(e){for(var t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}},{key:"applyPending",value:function(e){for(var t=0,r=this.pendingMarks;t<r.length;t++){var i=r[t];(this.type?this.type.allowsMarkType(i.type):et(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}},{key:"inlineContext",value:function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Oe.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}]),a}(),ne=function(){function a(n,e,t){g(this,a),this.parser=n,this.options=e,this.isOpen=t,this.open=0;var r=e.topNode,i,s=te(null,e.preserveWhitespace,0)|(t?R:0);r?i=new A(r.type,r.attrs,v.none,v.none,!0,e.topMatch||r.type.contentMatch,s):t?i=new A(null,null,v.none,v.none,!0,null,s):i=new A(n.schema.topNodeType,null,v.none,v.none,!0,null,s),this.nodes=[i],this.find=e.findPositions,this.needsBlock=!1}return y(a,[{key:"top",get:function(){return this.nodes[this.open]}},{key:"addDOM",value:function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var t=e.getAttribute("style"),r=t?this.readStyles($e(t)):null,i=this.top;if(r!=null)for(var s=0;s<r.length;s++)this.addPendingMark(r[s]);if(this.addElement(e),r!=null)for(var o=0;o<r.length;o++)this.removePendingMark(r[o],i)}}},{key:"addTextNode",value:function(e){var t=e.nodeValue,r=this.top;if(r.options&L||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(r.options&B)r.options&L?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){var i=r.content[r.content.length-1],s=e.previousSibling;(!i||s&&s.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}},{key:"addElement",value:function(e,t){var r=e.nodeName.toLowerCase(),i;Me.hasOwnProperty(r)&&this.parser.normalizeLists&&Ye(e);var s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,t));if(s?s.ignore:Xe.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);var o,u=this.top,f=this.needsBlock;if(Oe.hasOwnProperty(r))o=!0,u.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),o&&this.sync(u),this.needsBlock=f}else this.addElementByRule(e,s,s.consuming===!1?i:void 0)}},{key:"leafFallback",value:function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}},{key:"ignoreFallback",value:function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}},{key:"readStyles",value:function(e){var t=v.none;e:for(var r=0;r<e.length;r+=2)for(var i=void 0;;){var s=this.parser.matchStyle(e[r],e[r+1],this,i);if(!s)continue e;if(s.ignore)return null;if(t=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(t),s.consuming===!1)i=s;else break}return t}},{key:"addElementByRule",value:function(e,t,r){var i=this,s,o,u;if(t.node)o=this.parser.schema.nodes[t.node],o.isLeaf?this.insertNode(o.create(t.attrs))||this.leafFallback(e):s=this.enter(o,t.attrs||null,t.preserveWhitespace);else{var f=this.parser.schema.marks[t.mark];u=f.create(t.attrs),this.addPendingMark(u)}var l=this.top;if(o&&o.isLeaf)this.findInside(e);else if(r)this.addElement(e,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(function(c){return i.insertNode(c)});else{var h=e;typeof t.contentElement=="string"?h=e.querySelector(t.contentElement):typeof t.contentElement=="function"?h=t.contentElement(e):t.contentElement&&(h=t.contentElement),this.findAround(e,h,!0),this.addAll(h)}s&&this.sync(l)&&this.open--,u&&this.removePendingMark(u,l)}},{key:"addAll",value:function(e,t,r){for(var i=t||0,s=t?e.childNodes[t]:e.firstChild,o=r==null?null:e.childNodes[r];s!=o;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s);this.findAtPoint(e,i)}},{key:"findPlace",value:function(e){for(var t,r,i=this.open;i>=0;i--){var s=this.nodes[i],o=s.findWrapping(e);if(o&&(!t||t.length>o.length)&&(t=o,r=s,!o.length)||s.solid)break}if(!t)return!1;this.sync(r);for(var u=0;u<t.length;u++)this.enterInner(t[u],null,!1);return!0}},{key:"insertNode",value:function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();var r=this.top;r.applyPending(e.type),r.match&&(r.match=r.match.matchType(e.type));for(var i=r.activeMarks,s=0;s<e.marks.length;s++)(!r.type||r.type.allowsMarkType(e.marks[s].type))&&(i=e.marks[s].addToSet(i));return r.content.push(e.mark(i)),!0}return!1}},{key:"enter",value:function(e,t,r){var i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,r),i}},{key:"enterInner",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3?arguments[3]:void 0;this.closeExtra();var s=this.top;s.applyPending(e),s.match=s.match&&s.match.matchType(e);var o=te(e,i,s.options);s.options&R&&s.content.length==0&&(o|=R),this.nodes.push(new A(e,t,s.activeMarks,s.pendingMarks,r,null,o)),this.open++}},{key:"closeExtra",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}},{key:"finish",value:function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}},{key:"sync",value:function(e){for(var t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}},{key:"currentPos",get:function(){this.closeExtra();for(var e=0,t=this.open;t>=0;t--){for(var r=this.nodes[t].content,i=r.length-1;i>=0;i--)e+=r[i].nodeSize;t&&e++}return e}},{key:"findAtPoint",value:function(e,t){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}},{key:"findInside",value:function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}},{key:"findAround",value:function(e,t,r){if(e!=t&&this.find){for(var i=0;i<this.find.length;i++)if(this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)){var s=t.compareDocumentPosition(this.find[i].node);s&(r?2:4)&&(this.find[i].pos=this.currentPos)}}}},{key:"findInText",value:function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}},{key:"matchesContext",value:function(e){var t=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var r=e.split("/"),i=this.options.context,s=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),o=-(i?i.depth+1:0)+(s?0:1),u=function f(l,h){for(;l>=0;l--){var c=r[l];if(c==""){if(l==r.length-1||l==0)continue;for(;h>=o;h--)if(f(l-1,h))return!0;return!1}else{var d=h>0||h==0&&s?t.nodes[h].type:i&&h>=o?i.node(h-o).type:null;if(!d||d.name!=c&&d.groups.indexOf(c)==-1)return!1;h--}}return!0};return u(r.length-1,this.open)}},{key:"textblockFromContext",value:function(){var e=this.options.context;if(e)for(var t=e.depth;t>=0;t--){var r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(var i in this.parser.schema.nodes){var s=this.parser.schema.nodes[i];if(s.isTextblock&&s.defaultAttrs)return s}}},{key:"addPendingMark",value:function(e){var t=tt(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}},{key:"removePendingMark",value:function(e,t){for(var r=this.open;r>=0;r--){var i=this.nodes[r],s=i.pendingMarks.lastIndexOf(e);if(s>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);var o=i.popFromStashMark(e);o&&i.type&&i.type.allowsMarkType(o.type)&&(i.activeMarks=o.addToSet(i.activeMarks))}if(i==t)break}}}]),a}();function Ye(a){for(var n=a.firstChild,e=null;n;n=n.nextSibling){var t=n.nodeType==1?n.nodeName.toLowerCase():null;t&&Me.hasOwnProperty(t)&&e?(e.appendChild(n),n=e):t=="li"?e=n:t&&(e=null)}}function Ze(a,n){return(a.matches||a.msMatchesSelector||a.webkitMatchesSelector||a.mozMatchesSelector).call(a,n)}function $e(a){for(var n=/\s*([\w-]+)\s*:\s*([^;]+)/g,e,t=[];e=n.exec(a);)t.push(e[1],e[2].trim());return t}function re(a){var n={};for(var e in a)n[e]=a[e];return n}function et(a,n){var e=n.schema.nodes,t=function(o){var u=e[o];if(!u.allowsMarkType(a))return"continue";var f=[],l=function h(c){f.push(c);for(var d=0;d<c.edgeCount;d++){var m=c.edge(d),x=m.type,S=m.next;if(x==n||f.indexOf(S)<0&&h(S))return!0}};if(l(u.contentMatch))return{v:!0}};for(var r in e){var i=t(r);if(i!=="continue"&&w(i)==="object")return i.v}}function tt(a,n){for(var e=0;e<n.length;e++)if(a.eq(n[e]))return n[e]}var nt=function(){function a(n,e){g(this,a),this.nodes=n,this.marks=e}return y(a,[{key:"serializeFragment",value:function(e){var t=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;i||(i=V(r).createDocumentFragment());var s=i,o=[];return e.forEach(function(u){if(o.length||u.marks.length){for(var f=0,l=0;f<o.length&&l<u.marks.length;){var h=u.marks[l];if(!t.marks[h.type.name]){l++;continue}if(!h.eq(o[f][0])||h.type.spec.spanning===!1)break;f++,l++}for(;f<o.length;)s=o.pop()[1];for(;l<u.marks.length;){var c=u.marks[l++],d=t.serializeMark(c,u.isInline,r);d&&(o.push([c,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(t.serializeNodeInner(u,r))}),i}},{key:"serializeNodeInner",value:function(e,t){var r=a.renderSpec(V(t),this.nodes[e.type.name](e)),i=r.dom,s=r.contentDOM;if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return i}},{key:"serializeNode",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.serializeNodeInner(e,t),i=e.marks.length-1;i>=0;i--){var s=this.serializeMark(e.marks[i],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}},{key:"serializeMark",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=this.marks[e.type.name];return i&&a.renderSpec(V(r),i(e,t))}}],[{key:"renderSpec",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;var i=t[0],s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));var o,u=r?e.createElementNS(r,i):e.createElement(i),f=t[1],l=1;if(f&&w(f)=="object"&&f.nodeType==null&&!Array.isArray(f)){l=2;for(var h in f)if(f[h]!=null){var c=h.indexOf(" ");c>0?u.setAttributeNS(h.slice(0,c),h.slice(c+1),f[h]):u.setAttribute(h,f[h])}}for(var d=l;d<t.length;d++){var m=t[d];if(m===0){if(d<t.length-1||d>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:u,contentDOM:u}}else{var x=a.renderSpec(e,m,r),S=x.dom,F=x.contentDOM;if(u.appendChild(S),F){if(o)throw new RangeError("Multiple content holes");o=F}}}return{dom:u,contentDOM:o}}},{key:"fromSchema",value:function(e){return e.cached.domSerializer||(e.cached.domSerializer=new a(this.nodesFromSchema(e),this.marksFromSchema(e)))}},{key:"nodesFromSchema",value:function(e){var t=ie(e.nodes);return t.text||(t.text=function(r){return r.text}),t}},{key:"marksFromSchema",value:function(e){return ie(e.marks)}}]),a}();function ie(a){var n={};for(var e in a){var t=a[e].spec.toDOM;t&&(n[e]=t)}return n}function V(a){return a.document||window.document}k.ContentMatch=N;var it=k.DOMParser=Qe;k.DOMSerializer=nt;var at=k.Fragment=p,st=k.Mark=v,ot=k.MarkType=we,ut=k.Node=E,ft=k.NodeRange=pe;k.NodeType=Q;var ht=k.ReplaceError=I;k.ResolvedPos=K;var lt=k.Schema=Ke,ct=k.Slice=b;export{it as D,at as F,st as M,ft as N,ht as R,lt as S,ct as a,ut as b,ot as c,k as d};
